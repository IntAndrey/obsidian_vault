---
title: "–í–æ–∑–º–æ–∂–Ω–æ, —Å–∞–º—ã–π –≥–µ–Ω–∏–∞–ª—å–Ω—ã–π –∫–æ–¥ –Ω–∞ python –Ω–∞ —Å–µ–≥–æ–¥–Ω—è: —Ä–∞–∑–±–∏—Ä–∞–µ–º 200-—Å—Ç—Ä–æ—á–Ω—ã–π microgpt –æ—Ç –ê–Ω–¥—Ä–µ—è –ö–∞—Ä–ø–∞—Ç—ã"
source: "https://habr.com/ru/articles/996404/"
author:
  - "[[–ê–ª–µ–∫—Å–∞–Ω–¥—Ä –®–∫–æ–ª—å–Ω–∏–∫–æ–≤]]"
published: 2026-02-15
created: 2026-02-15
description: "–í—Å—ë –º–∏–∫—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –Ω–µ –º–µ–Ω—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è, —á–µ–º –≥–∏–≥–∞–Ω—Ç—Å–∫–æ–µ... –ë—É–∫–≤–∞–ª—å–Ω–æ –Ω–∞ –¥–Ω—è—Ö –ê–Ω–¥—Ä–µ–π –ö–∞—Ä–ø–∞—Ç—ã, –æ–¥–∏–Ω –∏–∑ —Ä–∞–Ω–Ω–∏—Ö —Å–æ–æ—Å–Ω–æ–≤–∞—Ç–µ–ª–µ–π OpenAI, –ø–æ–∫–∏–Ω—É–≤—à–∏–π –∫–æ–º–ø–∞–Ω–∏—é, –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π, –æ–ø—É–±–ª–∏–∫–æ–≤–∞–ª..."
tags:
  - "clippings"
---
[–ê–≤—Ç–æ—Ä –æ—Ä–∏–≥–∏–Ω–∞–ª–∞: Andrej Karpathy](https://karpathy.github.io/2026/02/12/microgpt/)

![–í—Å—ë –º–∏–∫—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –Ω–µ –º–µ–Ω—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è, —á–µ–º –≥–∏–≥–∞–Ω—Ç—Å–∫–æ–µ...](https://habrastorage.org/r/w780/getpro/habr/upload_files/b78/668/790/b7866879008689a8a9ae372ef34882ab.jpg)

–í—Å—ë –º–∏–∫—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –Ω–µ –º–µ–Ω—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è, —á–µ–º –≥–∏–≥–∞–Ω—Ç—Å–∫–æ–µ...

–ë—É–∫–≤–∞–ª—å–Ω–æ –Ω–∞ –¥–Ω—è—Ö –ê–Ω–¥—Ä–µ–π –ö–∞—Ä–ø–∞—Ç—ã, –æ–¥–∏–Ω –∏–∑ —Ä–∞–Ω–Ω–∏—Ö —Å–æ–æ—Å–Ω–æ–≤–∞—Ç–µ–ª–µ–π OpenAI, –ø–æ–∫–∏–Ω—É–≤—à–∏–π –∫–æ–º–ø–∞–Ω–∏—é, –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π, [–æ–ø—É–±–ª–∏–∫–æ–≤–∞–ª –Ω–∞ –ì–∏—Ç—Ö–∞–±](https://gist.github.com/karpathy/8627fe009c40f57531cb18360106ce95) —Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–µ—Å–∫—É—é –≤–µ—â—å: —á–∏—Å—Ç—ã–π (–±–µ–∑ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫) 200-—Å—Ç—Ä–æ—á–Ω—ã–π python-–∫–æ–¥ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–∞, –∞–Ω–∞–ª–æ–≥–∞ GPT-2, –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –≤—Å–µ–º–∏ –∂–µ–ª–∞—é—â–∏–º–∏. –ò –Ω–∞–ø–∏—Å–∞–ª –≤ –±–ª–æ–≥–µ [—Å—Ç–∞—Ç—å—é –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —ç—Ç–æ–≥–æ –∫–æ–¥–∞](https://karpathy.github.io/2026/02/12/microgpt/) (–∏ —Ä–∞–±–æ—Ç—ã —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä–æ–≤). –Ø –ø–µ—Ä–µ–≤—ë–ª —Å—Ç–∞—Ç—å—é –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–æ–¥—É ‚Äî –≤–µ–¥—å —ç—Ç–æ—Ç –∫–æ–¥ (—è —É–≤–µ—Ä–µ–Ω!) –≤–æ–π–¥—ë—Ç –≤ –ò–¢-–∏—Å—Ç–æ—Ä–∏—é...

–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —ç—Ç–æ–º—É –∑–∞–≤–æ—Ä–∞–∂–∏–≤–∞—é—â–µ–º—É —Å–µ–∞–Ω—Å—É —Ä–∞–∑–æ–±–ª–∞—á–µ–Ω–∏—è gpt-–º–∞–≥–∏–∏, –∑–∞ —Å—á–∏—Ç–∞–Ω–Ω—ã–µ –≥–æ–¥—ã –æ–≤–ª–∞–¥–µ–≤—à–µ–π –º–∏—Ä–æ–º –∏ —ç–∫–æ–Ω–æ–º–∏–∫–æ–π!..

## microgpt

12 —Ñ–µ–≤—Ä–∞–ª—è 2026 –≥–æ–¥–∞

[Andrej Karpathy](https://karpathy.github.io/)

–≠—Ç–æ –∫—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–æ–µ–º—É –Ω–æ–≤–æ–º—É –∞—Ä—Ç-–ø—Ä–æ–µ–∫—Ç—É [**microgpt**](https://gist.github.com/karpathy/8627fe009c40f57531cb18360106ce95) ‚Äî –æ–¥–Ω–æ–º—É —Ñ–∞–π–ª—É –Ω–∞ —á–∏—Å—Ç–æ–º Python, —Å–æ—Å—Ç–æ—è—â–µ–º—É –∏–∑ 200 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç –æ–±—É—á–µ–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–∏–Ω—Ñ–µ—Ä–µ–Ω—Å) GPT-–º–æ–¥–µ–ª–∏. –í —ç—Ç–æ–º —Ñ–∞–π–ª–µ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –ø–æ–ª–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏–π –Ω–∞–±–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä, –¥–≤–∏–∂–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è (autograd), –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏, —Å—Ö–æ–¥–Ω–∞—è —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π GPT-2, –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä Adam, —Ü–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è –∏ —Ü–∏–∫–ª –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏. –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ, —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –∑–∞ –±–æ—Ä—Ç–æ–º ‚Äî —ç—Ç–æ –ª–∏—à—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ–≤—ã—à–µ–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ LLM. –Ø –Ω–µ —Å–º–æ–≥ –±—ã —É–ø—Ä–æ—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–¥ –µ—â—ë —Å–∏–ª—å–Ω–µ–µ. –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —è–≤–ª—è–µ—Ç—Å—è –∫—É–ª—å–º–∏–Ω–∞—Ü–∏–µ–π –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ (micrograd, makemore, nanogpt –∏ –¥—Ä.) –∏ –¥–µ—Å—è—Ç–∏–ª–µ—Ç–Ω–µ–≥–æ —Å—Ç—Ä–µ–º–ª–µ–Ω–∏—è —Å–≤–µ—Å—Ç–∏ –±–æ–ª—å—à–∏–µ —è–∑—ã–∫–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –∫ –∏—Ö —Å–∞–º–æ–π —Å—É—Ç–∏, –∏, –ø–æ-–º–æ–µ–º—É, —ç—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ ü•π.

–ù–∏–∂–µ –≤—ã –≤–∏–¥–∏—Ç–µ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∏–¥–µ–∞–ª—å–Ω–æ —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞ 3 –∫–æ–ª–æ–Ω–∫–∏:

![–í—Å–µ–≥–æ 200 —Å—Ç—Ä–æ–∫ –∏ 3 –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ –±–æ–ª—å—à–æ–º —ç–∫—Ä–∞–Ω–µ...](https://habrastorage.org/r/w780/getpro/habr/upload_files/11c/e6e/ec9/11ce6eec98e774880607a6219b536123.jpg)

–í—Å–µ–≥–æ 200 —Å—Ç—Ä–æ–∫ –∏ 3 –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ –±–æ–ª—å—à–æ–º —ç–∫—Ä–∞–Ω–µ...

–ì–¥–µ –≤—Å—ë —ç—Ç–æ –Ω–∞–π—Ç–∏:

- –ü–æ–ª–Ω—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —ç—Ç–æ–º [GitHub gist: **microgpt.py**](https://gist.github.com/karpathy/8627fe009c40f57531cb18360106ce95)
- –¢–∞–∫–∂–µ –æ–Ω –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –Ω–∞ —ç—Ç–æ–π –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–µ: [https://karpathy.ai/microgpt.html](https://karpathy.ai/microgpt.html)
- –ò –¥–æ—Å—Ç—É–ø–µ–Ω –∫–∞–∫ [Google Colab notebook](https://colab.research.google.com/drive/1vyN5zo6rqUp_dYNbT4Yrco66zuWCZKoN?usp=sharing)
–ó–¥–µ—Å—å –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –≤—Å–µ 200 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, —Å –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—ã–º–∏ –Ω–∞ —Ä—É—Å—Å–∫–∏–π –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏ –∏ –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏:

```python
"""
–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π, —ç–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–±—É—á–∏—Ç—å –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å GPT –Ω–∞ —á–∏—Å—Ç–æ–º Python –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º.
–í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ª–∏—à—å –≤–æ–ø—Ä–æ—Å—ã —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

@karpathy
"""

import os       # os.path.exists
import math     # math.log, math.exp
import random   # random.seed, random.choices, random.gauss, random.shuffle
random.seed(42) # –î–∞ –±—É–¥–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Å—Ä–µ–¥–∏ —Ö–∞–æ—Å–∞

# –ü—É—Å—Ç—å —É –Ω–∞—Å –µ—Å—Ç—å –≤—Ö–æ–¥–Ω–æ–π dataset \`docs\`: list[str] - —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (—Ç.–µ. dataset –∏–º–µ–Ω)
if not os.path.exists('input.txt'):
    import urllib.request
    names_url = 'https://raw.githubusercontent.com/karpathy/makemore/refs/heads/master/names.txt'
    urllib.request.urlretrieve(names_url, 'input.txt')
docs = [l.strip() for l in open('input.txt').read().strip().split('\n') if l.strip()] # list[str] —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
random.shuffle(docs)
print(f"–∫–æ–ª-–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: {len(docs)}")

# –°–¥–µ–ª–∞–µ–º –¢–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å—Ç—Ä–æ–∫ –≤ –¥–∏—Å–∫—Ä–µ—Ç–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏ –æ–±—Ä–∞—Ç–Ω–æ
uchars = sorted(set(''.join(docs))) # —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –≤ –Ω–∞–±–æ—Ä–µ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç 0 –¥–æ n-1
BOS = len(uchars) # –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–∫–µ–Ω–∞ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –ù–∞—á–∞–ª–∞ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (Beginning of Sequence, BOS)
vocab_size = len(uchars) + 1 # –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤, +1 –¥–ª—è BOS
print(f"—Ä–∞–∑–º–µ—Ä —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä–∞, —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤: {vocab_size}")

# –°–¥–µ–ª–∞–µ–º Autograd, —á—Ç–æ–±—ã —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª–æ —Ü–µ–ø–∏ —á–µ—Ä–µ–∑ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ
class Value:
    __slots__ = ('data', 'grad', '_children', '_local_grads') # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –≤ Python

    def __init__(self, data, children=(), local_grads=()):
        self.data = data                # —Å–∫–∞–ª—è—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ —É–∑–ª–∞, –≤—ã—á–∏—Å–ª–µ–Ω–Ω–æ–µ –≤–æ –≤—Ä–µ–º—è –ø—Ä—è–º–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞
        self.grad = 0                   # –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å –ø–æ –¥–∞–Ω–Ω–æ–º—É —É–∑–ª—É, –≤—ã—á–∏—Å–ª–µ–Ω–Ω–∞—è –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–¥–∞
        self._children = children       # –¥–æ—á–µ—Ä–Ω–∏–µ —É–∑–ª—ã –¥–∞–Ω–Ω–æ–≥–æ —É–∑–ª–∞ –≤ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ–º –≥—Ä–∞—Ñ–µ
        self._local_grads = local_grads # –ª–æ–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è —ç—Ç–æ–≥–æ —É–∑–ª–∞ –ø–æ –µ–≥–æ –¥–æ—á–µ—Ä–Ω–∏–º —É–∑–ª–∞–º

    def __add__(self, other):
        other = other if isinstance(other, Value) else Value(other)
        return Value(self.data + other.data, (self, other), (1, 1))

    def __mul__(self, other):
        other = other if isinstance(other, Value) else Value(other)
        return Value(self.data * other.data, (self, other), (other.data, self.data))

    def __pow__(self, other): return Value(self.data**other, (self,), (other * self.data**(other-1),))
    def log(self): return Value(math.log(self.data), (self,), (1/self.data,))
    def exp(self): return Value(math.exp(self.data), (self,), (math.exp(self.data),))
    def relu(self): return Value(max(0, self.data), (self,), (float(self.data > 0),))
    def __neg__(self): return self * -1
    def __radd__(self, other): return self + other
    def __sub__(self, other): return self + (-other)
    def __rsub__(self, other): return other + (-self)
    def __rmul__(self, other): return self * other
    def __truediv__(self, other): return self * other**-1
    def __rtruediv__(self, other): return other * self**-1

    def backward(self):
        topo = []
        visited = set()
        def build_topo(v):
            if v not in visited:
                visited.add(v)
                for child in v._children:
                    build_topo(child)
                topo.append(v)
        build_topo(self)
        self.grad = 1
        for v in reversed(topo):
            for child, local_grad in zip(v._children, v._local_grads):
                child.grad += local_grad * v.grad

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —á—Ç–æ–±—ã —Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞–Ω–∏—è –º–æ–¥–µ–ª–∏.
n_embd = 16     # —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
n_head = 4      # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ–≤ –≤–Ω–∏–º–∞–Ω–∏—è
n_layer = 1     # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ—ë–≤
block_size = 16 # –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
head_dim = n_embd // n_head # —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–π –≥–æ–ª–æ–≤—ã
matrix = lambda nout, nin, std=0.08: [[Value(random.gauss(0, std)) for _ in range(nin)] for _ in range(nout)]
state_dict = {'wte': matrix(vocab_size, n_embd), 'wpe': matrix(block_size, n_embd), 'lm_head': matrix(vocab_size, n_embd)}
for i in range(n_layer):
    state_dict[f'layer{i}.attn_wq'] = matrix(n_embd, n_embd)
    state_dict[f'layer{i}.attn_wk'] = matrix(n_embd, n_embd)
    state_dict[f'layer{i}.attn_wv'] = matrix(n_embd, n_embd)
    state_dict[f'layer{i}.attn_wo'] = matrix(n_embd, n_embd)
    state_dict[f'layer{i}.mlp_fc1'] = matrix(4 * n_embd, n_embd)
    state_dict[f'layer{i}.mlp_fc2'] = matrix(n_embd, 4 * n_embd)
params = [p for mat in state_dict.values() for row in mat for p in row] # –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –æ–¥–∏–Ω list[Value]
print(f"–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: {len(params)}")

# –û–ø—Ä–µ–¥–µ–ª–∏–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–æ–¥–µ–ª–∏: stateless-—Ñ—É–Ω–∫—Ü–∏—è, –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –ª–æ–≥–∏—Ç—ã —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞.
# –°–ª–µ–¥—É–µ–º GPT-2, –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω–æ–π —Å—Ä–µ–¥–∏ GPT, —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –æ—Ç–ª–∏—á–∏—è–º–∏: layernorm -> rmsnorm, –±–µ–∑ —Å–º–µ—â–µ–Ω–∏–π, GeLU -> ReLU
def linear(x, w):
    return [sum(wi * xi for wi, xi in zip(wo, x)) for wo in w]

def softmax(logits):
    max_val = max(val.data for val in logits)
    exps = [(val - max_val).exp() for val in logits]
    total = sum(exps)
    return [e / total for e in exps]

def rmsnorm(x):
    ms = sum(xi * xi for xi in x) / len(x)
    scale = (ms + 1e-5) ** -0.5
    return [xi * scale for xi in x]

def gpt(token_id, pos_id, keys, values):
    tok_emb = state_dict['wte'][token_id] # —ç–º–±–µ–¥–¥–∏–Ω–≥ —Ç–æ–∫–µ–Ω–æ–≤
    pos_emb = state_dict['wpe'][pos_id] # —ç–º–±–µ–¥–¥–∏–Ω–≥ –ø–æ–∑–∏—Ü–∏–∏
    x = [t + p for t, p in zip(tok_emb, pos_emb)] # –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —ç–º–±–µ–¥–¥–∏–Ω–≥ —Ç–æ–∫–µ–Ω–æ–≤ –∏ –ø–æ–∑–∏—Ü–∏–π
    x = rmsnorm(x)

    for li in range(n_layer):
        # 1) –ë–ª–æ–∫ –º–Ω–æ–≥–æ–≥–æ–ª–æ–≤–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è
        x_residual = x
        x = rmsnorm(x)
        q = linear(x, state_dict[f'layer{li}.attn_wq'])
        k = linear(x, state_dict[f'layer{li}.attn_wk'])
        v = linear(x, state_dict[f'layer{li}.attn_wv'])
        keys[li].append(k)
        values[li].append(v)
        x_attn = []
        for h in range(n_head):
            hs = h * head_dim
            q_h = q[hs:hs+head_dim]
            k_h = [ki[hs:hs+head_dim] for ki in keys[li]]
            v_h = [vi[hs:hs+head_dim] for vi in values[li]]
            attn_logits = [sum(q_h[j] * k_h[t][j] for j in range(head_dim)) / head_dim**0.5 for t in range(len(k_h))]
            attn_weights = softmax(attn_logits)
            head_out = [sum(attn_weights[t] * v_h[t][j] for t in range(len(v_h))) for j in range(head_dim)]
            x_attn.extend(head_out)
        x = linear(x_attn, state_dict[f'layer{li}.attn_wo'])
        x = [a + b for a, b in zip(x, x_residual)]
        # 2) MLP –±–ª–æ–∫
        x_residual = x
        x = rmsnorm(x)
        x = linear(x, state_dict[f'layer{li}.mlp_fc1'])
        x = [xi.relu() for xi in x]
        x = linear(x, state_dict[f'layer{li}.mlp_fc2'])
        x = [a + b for a, b in zip(x, x_residual)]

    logits = linear(x, state_dict['lm_head'])
    return logits

# –°–æ–∑–¥–∞–¥–∏–º –ê–¥–∞–º–∞, –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω–æ–≥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞, –∏ –µ–≥–æ –±—É—Ñ–µ—Ä—ã
learning_rate, beta1, beta2, eps_adam = 0.01, 0.85, 0.99, 1e-8
m = [0.0] * len(params) # –±—É—Ñ–µ—Ä –ø–µ—Ä–≤–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞
v = [0.0] * len(params) # –±—É—Ñ–µ—Ä –≤—Ç–æ—Ä–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞

# –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
num_steps = 1000 # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –æ–±—É—á–µ–Ω–∏—è
for step in range(num_steps):

    # –ë–µ—Ä—ë–º –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç, —Ç–æ–∫–µ–Ω–∏–∑–∏—Ä—É–µ–º –µ–≥–æ, –æ–±—Ä–∞–º–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º BOS —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω
    doc = docs[step % len(docs)]
    tokens = [BOS] + [uchars.index(ch) for ch in doc] + [BOS]
    n = min(block_size, len(tokens) - 1)

    # –ü—Ä–æ–≥–æ–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª—å, –≤—ã—Å—Ç—Ä–∞–∏–≤–∞—è –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ –≤–ø–ª–æ—Ç—å –¥–æ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å.
    keys, values = [[] for _ in range(n_layer)], [[] for _ in range(n_layer)]
    losses = []
    for pos_id in range(n):
        token_id, target_id = tokens[pos_id], tokens[pos_id + 1]
        logits = gpt(token_id, pos_id, keys, values)
        probs = softmax(logits)
        loss_t = -probs[target_id].log()
        losses.append(loss_t)
    loss = (1 / n) * sum(losses) # –∏—Ç–æ–≥–æ–≤—ã–µ —Å—Ä–µ–¥–Ω–∏–µ –ø–æ—Ç–µ—Ä–∏ –ø–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞. –î–∞ –±—É–¥—É—Ç –æ–Ω–∏ –Ω–∏–∑–∫–∏–º–∏.

    # –í—ã–ø–æ–ª–Ω—è–µ–º –æ–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ—Ö–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å, –≤—ã—á–∏—Å–ª—è—è –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –ø–æ –≤—Å–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –º–æ–¥–µ–ª–∏.
    loss.backward()

    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–æ–º Adam: –æ–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤.
    lr_t = learning_rate * (1 - step / num_steps) # –ª–∏–Ω–µ–π–Ω–æ–µ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—É—á–µ–Ω–∏—è
    for i, p in enumerate(params):
        m[i] = beta1 * m[i] + (1 - beta1) * p.grad
        v[i] = beta2 * v[i] + (1 - beta2) * p.grad ** 2
        m_hat = m[i] / (1 - beta1 ** (step + 1))
        v_hat = v[i] / (1 - beta2 ** (step + 1))
        p.data -= lr_t * m_hat / (v_hat ** 0.5 + eps_adam)
        p.grad = 0

    print(f"step {step+1:4d} / {num_steps:4d} | loss {loss.data:.4f}")

# –ò–Ω—Ñ–µ—Ä–µ–Ω—Å: –ø—É—Å—Ç—å –º–æ–¥–µ–ª—å –±—É–±–Ω–∏—Ç –Ω–∞–º –≤ –æ—Ç–≤–µ—Ç
temperature = 0.5 # –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ (0, 1], –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç "–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å" –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, –æ—Ç –Ω–∏–∑–∫–æ–π –¥–æ –≤—ã—Å–æ–∫–æ–π
print("\n--- –∏–Ω—Ñ–µ—Ä–µ–Ω—Å (–Ω–æ–≤—ã–µ, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–º–µ–Ω–∞) ---")
for sample_idx in range(20):
    keys, values = [[] for _ in range(n_layer)], [[] for _ in range(n_layer)]
    token_id = BOS
    sample = []
    for pos_id in range(block_size):
        logits = gpt(token_id, pos_id, keys, values)
        probs = softmax([l / temperature for l in logits])
        token_id = random.choices(range(vocab_size), weights=[p.data for p in probs])[0]
        if token_id == BOS:
            break
        sample.append(uchars[token_id])
    print(f"–û–±—Ä–∞–∑–µ—Ü {sample_idx+1:2d}: {''.join(sample)}")–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

### Dataset

–¢–æ–ø–ª–∏–≤–æ–º –¥–ª—è –±–æ–ª—å—à–∏—Ö —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π —è–≤–ª—è–µ—Ç—Å—è –ø–æ—Ç–æ–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö, —á–∞—Å—Ç–æ —Ä–∞–∑–¥–µ–ª—ë–Ω–Ω—ã—Ö –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã. –í –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –∫–∞–∂–¥—ã–π –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî —ç—Ç–æ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, –Ω–æ –≤ microgpt –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä: 32 000 —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –∏–º—ë–Ω, –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É.

```python
# Let there be an input dataset \`docs\`: list[str] of documents (e.g. a dataset of names)
if not os.path.exists('input.txt'):
    import urllib.request
    names_url = 'https://raw.githubusercontent.com/karpathy/makemore/refs/heads/master/names.txt'
    urllib.request.urlretrieve(names_url, 'input.txt')
docs = [l.strip() for l in open('input.txt').read().strip().split('\n') if l.strip()] # list[str] of documents
random.shuffle(docs)
print(f"num docs: {len(docs)}")–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–ü—Ä–∏–º–µ—Ä –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö: –∫–∞–∂–¥–æ–µ –∏–º—è ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç.

```python
emma
olivia
ava
isabella
sophia
charlotte
mia
amelia
harper
... (~32,000 –∏–º–µ–Ω)–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–¶–µ–ª—å –º–æ–¥–µ–ª–∏ ‚Äî –≤—ã—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –≤ —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∑–∞—Ç–µ–º –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ, –ø–æ—Ö–æ–∂–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã. –°–ø–æ–π–ª–µ—Ä: –∫ –∫–æ–Ω—Ü—É —Å–∫—Ä–∏–ø—Ç–∞ –Ω–∞—à–∞ –º–æ–¥–µ–ª—å –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å (¬´–≥–∞–ª–ª—é—Ü–∏–Ω–∏—Ä–æ–≤–∞—Ç—å¬ª!) –Ω–æ–≤—ã–µ, –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–Ω—ã–µ –∏–º–µ–Ω–∞. –¢–∞–∫–∏–µ, –∫–∞–∫ —ç—Ç–∏:

```python
sample  1: kamon
sample  2: ann
sample  3: karai
sample  4: jaire
sample  5: vialan
sample  6: karia
sample  7: yeran
sample  8: anna
sample  9: areli
sample 10: kaina
sample 11: konna
sample 12: keylen
sample 13: liole
sample 14: alerin
sample 15: earan
sample 16: lenne
sample 17: kana
sample 18: lara
sample 19: alela
sample 20: anton–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–≠—Ç–æ –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å—Å—è –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º ¬´–¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ–º¬ª –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –∑–¥–µ—Å—å –∫–æ–¥–∞, –Ω–æ —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –≤—Ä–æ–¥–µ ChatGPT –≤–∞—à –¥–∏–∞–ª–æ–≥ —Å –Ω–µ–π ‚Äî –ø—Ä–æ—Å—Ç–æ ¬´–¥–æ–∫—É–º–µ–Ω—Ç¬ª –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–∞. –ö–æ–≥–¥–∞ –≤—ã –Ω–∞—á–∏–Ω–∞–µ—Ç–µ –¥–∏–∞–ª–æ–≥ —Å –∑–∞–ø—Ä–æ—Å–æ–º (–ø—Ä–æ–º–ø—Ç–æ–º), –æ—Ç–≤–µ—Ç –º–æ–¥–µ–ª–∏ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (–ø—Ä–æ–º–ø—Ç–∞).

### –¢–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä

–ù–µ–π—Ä–æ—Å–µ—Ç–∏ –≤–Ω—É—Ç—Ä–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å —á–∏—Å–ª–∞–º–∏, –∞ –Ω–µ —Å —Å–∏–º–≤–æ–ª–∞–º–∏, –ø–æ—ç—Ç–æ–º—É –Ω–∞–º –Ω—É–∂–µ–Ω —Å–ø–æ—Å–æ–± –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤-—Ç–æ–∫–µ–Ω–æ–≤ –∏ –æ–±—Ä–∞—Ç–Ω–æ. –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä—ã, —Ç–∞–∫–∏–µ –∫–∞–∫ [*tiktoken*](https://github.com/openai/tiktoken) (–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ GPT-4), —Ä–∞–±–æ—Ç–∞—é—Ç —Å –±–ª–æ–∫–∞–º–∏ (–Ω–µ–±–æ–ª—å—à–∏–º–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º–∏) —Å–∏–º–≤–æ–ª–æ–≤ —Ä–∞–¥–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –Ω–æ —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–æ–∑–º–æ–∂–Ω—ã–π —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä –ø—Ä–æ—Å—Ç–æ –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –æ–¥–Ω–æ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ –∫–∞–∂–¥–æ–º—É —É–Ω–∏–∫–∞–ª—å–Ω–æ–º—É —Å–∏–º–≤–æ–ª—É –≤ –Ω–∞–±–æ—Ä–µ –¥–∞–Ω–Ω—ã—Ö:

```python
# Let there be a Tokenizer to translate strings to discrete symbols and back
uchars = sorted(set(''.join(docs))) # unique characters in the dataset become token ids 0..n-1
BOS = len(uchars) # token id for the special Beginning of Sequence (BOS) token
vocab_size = len(uchars) + 1 # total number of unique tokens, +1 is for BOS
print(f"vocab size: {vocab_size}")–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–í –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω–æ–º –∫–æ–¥–µ –º—ã —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ ‚Äî —Å—Ç—Ä–æ—á–Ω—ã–µ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã a‚Äìz), —Å–æ—Ä—Ç–∏—Ä—É–µ–º –∏—Ö, –∏ –∫–∞–∂–¥–æ–º—É —Å–∏–º–≤–æ–ª—É –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è ID –ø–æ –µ–≥–æ –∏–Ω–¥–µ–∫—Å—É. –°–∞–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª –Ω–µ –∏–º–µ—é—Ç –Ω–∏–∫–∞–∫–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è; –∫–∞–∂–¥—ã–π —Ç–æ–∫–µ–Ω ‚Äî –ø—Ä–æ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–∏—Å–∫—Ä–µ—Ç–Ω—ã–π —Å–∏–º–≤–æ–ª. –í–º–µ—Å—Ç–æ 0, 1, 2 –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —ç–º–æ–¥–∑–∏.

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –º—ã —Å–æ–∑–¥–∞—ë–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω `BOS` (Beginning of Sequence ‚Äî –Ω–∞—á–∞–ª–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏), –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É–∂–∏—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º. –û–Ω –≥–æ–≤–æ—Ä–∏—Ç –º–æ–¥–µ–ª–∏: ¬´–∑–¥–µ—Å—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è (–∏–ª–∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è) –Ω–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç¬ª. –í–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –∫–∞–∂–¥—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ–∫–µ–Ω–∞–º–∏ `BOS` —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω: `[BOS, e, m, m, a, BOS]`. –ú–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è, —á—Ç–æ `BOS` –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω–æ–≤–æ–µ –∏–º—è, –∞ —Å–ª–µ–¥—É—é—â–∏–π `BOS` –∑–∞–≤–µ—Ä—à–∞–µ—Ç –µ–≥–æ.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —É –Ω–∞—Å –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Å–ª–æ–≤–∞—Ä—å —Ä–∞–∑–º–µ—Ä–æ–º 27: 26 —Å—Ç—Ä–æ—á–Ω—ã—Ö –±—É–∫–≤ + 1 —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω `BOS`.

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ (Autograd)

–û–±—É—á–µ–Ω–∏–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ —Ç—Ä–µ–±—É–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –º–æ–¥–µ–ª–∏ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å, ¬´ *–µ—Å–ª–∏ —è –Ω–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á—É —ç—Ç–æ —á–∏—Å–ª–æ, –≤–æ–∑—Ä–∞—Å—Ç—ë—Ç –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å –∏ –Ω–∞—Å–∫–æ–ª—å–∫–æ?*¬ª. –í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –≥—Ä–∞—Ñ –∏–º–µ–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≤—Ö–æ–¥–æ–≤ (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–æ–¥–µ–ª–∏ –∏ –≤—Ö–æ–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã), –Ω–æ —Å–≤–æ–¥–∏—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É —Å–∫–∞–ª—è—Ä–Ω–æ–º—É –≤—ã—Ö–æ–¥—É ‚Äî *–≤–µ–ª–∏—á–∏–Ω–µ* *–ø–æ—Ç–µ—Ä—å* (loss).

–û–±—Ä–∞—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ (backpropagation) –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —ç—Ç–æ–≥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã—Ö–æ–¥–∞ –∏ –¥–≤–∏–∂–µ—Ç—Å—è –Ω–∞–∑–∞–¥ –ø–æ –≥—Ä–∞—Ñ—É, –≤—ã—á–∏—Å–ª—è—è –≥—Ä–∞–¥–∏–µ–Ω—Ç –ø–æ—Ç–µ—Ä–∏ –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫–æ –≤—Å–µ–º –≤—Ö–æ–¥–∞–º. –û–Ω–æ –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ *–ø—Ä–∞–≤–∏–ª–µ —Ü–µ–ø–æ—á–∫–∏* –∏–∑ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. –í –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö, —Ç–∞–∫–∏—Ö –∫–∞–∫ PyTorch, —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –ó–¥–µ—Å—å –∂–µ –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º —ç—Ç–æ —Å –Ω—É–ª—è –≤ –æ–¥–Ω–æ–º –∫–ª–∞—Å—Å–µ `Value`:

```python
class Value:
    __slots__ = ('data', 'grad', '_children', '_local_grads')

    def __init__(self, data, children=(), local_grads=()):
        self.data = data                # scalar value of this node calculated during forward pass
        self.grad = 0                   # derivative of the loss w.r.t. this node, calculated in backward pass
        self._children = children       # children of this node in the computation graph
        self._local_grads = local_grads # local derivative of this node w.r.t. its children

    def __add__(self, other):
        other = other if isinstance(other, Value) else Value(other)
        return Value(self.data + other.data, (self, other), (1, 1))

    def __mul__(self, other):
        other = other if isinstance(other, Value) else Value(other)
        return Value(self.data * other.data, (self, other), (other.data, self.data))

    def __pow__(self, other): return Value(self.data**other, (self,), (other * self.data**(other-1),))
    def log(self): return Value(math.log(self.data), (self,), (1/self.data,))
    def exp(self): return Value(math.exp(self.data), (self,), (math.exp(self.data),))
    def relu(self): return Value(max(0, self.data), (self,), (float(self.data > 0),))
    def __neg__(self): return self * -1
    def __radd__(self, other): return self + other
    def __sub__(self, other): return self + (-other)
    def __rsub__(self, other): return other + (-self)
    def __rmul__(self, other): return self * other
    def __truediv__(self, other): return self * other**-1
    def __rtruediv__(self, other): return other * self**-1

    def backward(self):
        topo = []
        visited = set()
        def build_topo(v):
            if v not in visited:
                visited.add(v)
                for child in v._children:
                    build_topo(child)
                topo.append(v)
        build_topo(self)
        self.grad = 1
        for v in reversed(topo):
            for child, local_grad in zip(v._children, v._local_grads):
                child.grad += local_grad * v.grad–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ —ç—Ç–æ —Å–∞–º–∞—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏ –Ω–∞—Å—ã—â–µ–Ω–Ω–∞—è —á–∞—Å—Ç—å, –∏ —É –º–µ–Ω—è –µ—Å—Ç—å 2,5-—á–∞—Å–æ–≤–æ–µ –≤–∏–¥–µ–æ –Ω–∞ —ç—Ç—É —Ç–µ–º—É: [micrograd video](https://www.youtube.com/watch?v=VMj-3S1tku0). –í–∫—Ä–∞—Ç—Ü–µ: –æ–±—ä–µ–∫—Ç `Value` –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –æ–¥–Ω–æ —Å–∫–∞–ª—è—Ä–Ω–æ–µ —á–∏—Å–ª–æ (`data`) –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç, –∫–∞–∫ –æ–Ω–æ –±—ã–ª–æ –≤—ã—á–∏—Å–ª–µ–Ω–æ. –ö–∞–∂–¥–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è ‚Äî —ç—Ç–æ –º–∞–ª–µ–Ω—å–∫–∏–π ¬´–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—Å–∫–∏–π –±–ª–æ–∫¬ª: –æ–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Ö–æ–¥—ã, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –≤—ã—Ö–æ–¥ (–ø—Ä—è–º–æ–π –ø—Ä–æ—Ö–æ–¥) –∏ –∑–Ω–∞–µ—Ç, –∫–∞–∫ –µ—ë –≤—ã—Ö–æ–¥ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–∞–∂–¥–æ–≥–æ –≤—Ö–æ–¥–∞ (–ª–æ–∫–∞–ª—å–Ω—ã–π –≥—Ä–∞–¥–∏–µ–Ω—Ç). –≠—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è *autograd*. –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –ø—Ä–∞–≤–∏–ª–æ —Ü–µ–ø–æ—á–∫–∏, —Å–æ–µ–¥–∏–Ω—è—é—â–µ–µ –±–ª–æ–∫–∏.

–ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –≤—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ `Value` (—Å–ª–æ–∂–µ–Ω–∏–µ, —É–º–Ω–æ–∂–µ–Ω–∏–µ –∏ —Ç.–¥.), —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –Ω–æ–≤—ã–π `Value`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–Ω–∏—Ç —Å–≤–æ–∏ –≤—Ö–æ–¥—ã (`_children`) –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ (`_local_grads`). –ù–∞–ø—Ä–∏–º–µ—Ä,`__mul__` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç, —á—Ç–æ

–∏

.

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Ç–∞–∫–∏—Ö ¬´–±–ª–æ–∫–æ–≤ –ª–µ–≥–æ¬ª:

| –û–ø–µ—Ä–∞—Ü–∏—è | –ü—Ä—è–º–æ–π –ø—Ä–æ—Ö–æ–¥ | –õ–æ–∫–∞–ª—å–Ω—ã–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã |
| --- | --- | --- |
| `a + b` | a + b | , |
| `a * b` | a ¬∑ b | , |
| `a**n` | a‚Åø |  |
| `log(a)` | ln(a) |  |
| `exp(a)` | e·µÉ |  |
| `relu(a)` | max(0,a) |  |

–ú–µ—Ç–æ–¥ `backward()` –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≥—Ä–∞—Ñ—É –≤ –æ–±—Ä–∞—Ç–Ω–æ–º —Ç–æ–ø–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ (–æ—Ç –≤–µ–ª–∏—á–∏–Ω—ã –ø–æ—Ç–µ—Ä–∏, loss –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º), –ø—Ä–∏–º–µ–Ω—è—è –ø—Ä–∞–≤–∏–ª–æ —Ü–µ–ø–æ—á–∫–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ. –ï—Å–ª–∏ `L` ‚Äî –ø–æ—Ç–µ—Ä—è, –∞ —É–∑–µ–ª –∏–º–µ–µ—Ç –ø–æ—Ç–æ–º–∫–∞ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º , —Ç–æ:

–≠—Ç–æ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –ø—É–≥–∞—é—â–µ, –µ—Å–ª–∏ –≤—ã –Ω–µ —É–≤–µ—Ä–µ–Ω—ã –≤ —Å–≤–æ–∏—Ö –ø–æ–∑–Ω–∞–Ω–∏—è—Ö –≤ –º–∞—Ç–µ–º–∞—Ç–∏–∫–µ, –Ω–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —É–º–Ω–æ–∂–µ–Ω–∏–µ –¥–≤—É—Ö —á–∏—Å–µ–ª. –ù–∞–ø—Ä–∏–º–µ—Ä: ¬´ *–ï—Å–ª–∏ –º–∞—à–∏–Ω–∞ –µ–¥–µ—Ç –≤–¥–≤–æ–µ –±—ã—Å—Ç—Ä–µ–µ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞, –∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥ ‚Äî –≤—á–µ—Ç–≤–µ—Ä–æ –±—ã—Å—Ç—Ä–µ–µ –ø–µ—à–µ—Ö–æ–¥–∞, —Ç–æ –º–∞—à–∏–Ω–∞ –µ–¥–µ—Ç –≤ 8 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ –ø–µ—à–µ—Ö–æ–¥–∞* ¬ª. –ü—Ä–∞–≤–∏–ª–æ —Ü–µ–ø–æ—á–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫ –∂–µ: –ø–µ—Ä–µ–º–Ω–æ–∂–∞—é—Ç—Å—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–¥–æ–ª—å –ø—É—Ç–∏.

–ú—ã –Ω–∞—á–∏–Ω–∞–µ–º —Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ `self.grad = 1` –¥–ª—è —É–∑–ª–∞ –ø–æ—Ç–µ—Ä–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ `‚àÇL/‚àÇL = 1`. –û—Ç—Ç—É–¥–∞ –ø—Ä–∞–≤–∏–ª–æ —Ü–µ–ø–æ—á–∫–∏ –ø—Ä–æ—Å—Ç–æ —É–º–Ω–æ–∂–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –≤–¥–æ–ª—å –∫–∞–∂–¥–æ–≥–æ –ø—É—Ç–∏ –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º.

–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä `+=` (–Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ, –∞ –Ω–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ). –ö–æ–≥–¥–∞ –∑–Ω–∞—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö –≥—Ä–∞—Ñ–∞ (–≥—Ä–∞—Ñ —Ä–∞–∑–≤–µ—Ç–≤–ª—è–µ—Ç—Å—è), –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –ø–æ –∫–∞–∂–¥–æ–π –≤–µ—Ç–≤–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –∏ –¥–æ–ª–∂–Ω—ã —Å—É–º–º–∏—Ä–æ–≤–∞—Ç—å—Å—è. –≠—Ç–æ —Å–ª–µ–¥—Å—Ç–≤–∏–µ –º–Ω–æ–≥–æ–º–µ—Ä–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ —Ü–µ–ø–æ—á–∫–∏: –µ—Å–ª–∏ –≤–ª–∏—è–µ—Ç –Ω–∞ —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—É—Ç–µ–π, —Ç–æ –æ–±—â–∏–π –≥—Ä–∞–¥–∏–µ–Ω—Ç ‚Äî —ç—Ç–æ —Å—É–º–º–∞ —Ç–∞–∫–∏—Ö –≤–∫–ª–∞–¥–æ–≤.

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `backward()`, –∫–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç `Value` –≤ –≥—Ä–∞—Ñ–µ —Å–æ–¥–µ—Ä–∂–∏—Ç `.grad = ‚àÇL/‚àÇv` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–º, –∫–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—Å—è –≤–µ–ª–∏—á–∏–Ω–∞ –ø–æ—Ç–µ—Ä–∏, loss –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.

–í–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä: –æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ `a` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã (–≥—Ä–∞—Ñ —Ä–∞–∑–≤–µ—Ç–≤–ª—è–µ—Ç—Å—è), –ø–æ—ç—Ç–æ–º—É –µ–≥–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è —Å—É–º–º–æ–π –æ–±–æ–∏—Ö –ø—É—Ç–µ–π:

```python
a = Value(2.0)
b = Value(3.0)
c = a * b       # c = 6.0
L = c + a       # L = 8.0
L.backward()
print(a.grad)   # 4.0 (dL/da = b + 1 = 3 + 1, via both paths)
print(b.grad)   # 2.0 (dL/db = a = 2)–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–ò–º–µ–Ω–Ω–æ —ç—Ç–æ –∏ –¥–∞—ë—Ç –º–µ—Ç–æ–¥ `.backward()` –≤ PyTorch:

```python
import torch
a = torch.tensor(2.0, requires_grad=True)
b = torch.tensor(3.0, requires_grad=True)
c = a * b
L = c + a
L.backward()
print(a.grad)   # tensor(4.)
print(b.grad)   # tensor(2.)–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–≠—Ç–æ —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç `loss.backward()` –≤ `PyTorch`, —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–∫–∞–ª—è—Ä–∞—Ö –≤–º–µ—Å—Ç–æ —Ç–µ–Ω–∑–æ—Ä–æ–≤ (–ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–∏—Ö —Å–æ–±–æ–π –º–∞—Å—Å–∏–≤—ã —Å–∫–∞–ª—è—Ä–æ–≤) ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π, –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–Ω—å—à–∏–π –∏ –Ω–∞–º–Ω–æ–≥–æ –ø—Ä–æ—â–µ, –Ω–æ, –∫–æ–Ω–µ—á–Ω–æ, –≥–æ—Ä–∞–∑–¥–æ –º–µ–Ω–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π.

–î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º, —á—Ç–æ –¥–∞–µ—Ç –Ω–∞–º `.backward()` –≤ –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ. Autograd –≤—ã—á–∏—Å–ª–∏–ª, —á—Ç–æ –µ—Å–ª–∏

`L = a*b + a`, –∞

`a=2` –∏ `b=3`, —Ç–æ

`a.grad = 4.0`.

–≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞–º –æ –ª–æ–∫–∞–ª—å–Ω–æ–º –≤–ª–∏—è–Ω–∏–∏ `a` –Ω–∞ `L`. –ï—Å–ª–∏ —Å–ª–µ–≥–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ö–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `a`, –≤ –∫–∞–∫–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–∏—Ç—Å—è `L`? –ó–¥–µ—Å—å –ø—Ä–æ–∏–∑–≤–æ–¥–Ω–∞—è `L` –ø–æ `a` —Ä–∞–≤–Ω–∞ `4.0`, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: –µ—Å–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å `a` –Ω–∞ –Ω–µ–±–æ–ª—å—à—É—é –≤–µ–ª–∏—á–∏–Ω—É (—Å–∫–∞–∂–µ–º, 0.001), `L` —É–≤–µ–ª–∏—á–∏—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ 4 —Ä–∞–∑–∞ —Å–∏–ª—å–Ω–µ–µ (–Ω–∞ 0.004).

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ, `b.grad = 2.0` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ç–∞–∫–æ–µ –∂–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ `b` –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —É–≤–µ–ª–∏—á–µ–Ω–∏—é `L` –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ 2 —Ä–∞–∑–∞ —Å–∏–ª—å–Ω–µ–µ (–Ω–∞ 0.002). –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —ç—Ç–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–Ω–∞–∫–∞) –∏ –∫—Ä—É—Ç–∏–∑–Ω—É (–≤–µ–ª–∏—á–∏–Ω—É) –≤–ª–∏—è–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –≤—Ö–æ–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –Ω–∞ –∫–æ–Ω–µ—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (—Ñ—É–Ω–∫—Ü–∏—é –ø–æ—Ç–µ—Ä—å). –≠—Ç–æ, –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ –∏–∑–º–µ–Ω—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—à–µ–π –Ω–µ–π—Ä–æ–Ω–Ω–æ–π —Å–µ—Ç–∏, —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å –∏, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, —É–ª—É—á—à–∏—Ç—å –µ–µ –ø—Ä–æ–≥–Ω–æ–∑—ã.

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî —ç—Ç–æ –∑–Ω–∞–Ω–∏—è –º–æ–¥–µ–ª–∏. –≠—Ç–æ –±–æ–ª—å—à–æ–π –Ω–∞–±–æ—Ä —á–∏—Å–µ–ª —Å –ø–ª–∞–≤–∞—é—â–µ–π —Ç–æ—á–∫–æ–π (–æ–±—ë—Ä–Ω—É—Ç—ã—Ö –≤ `Value` –¥–ª—è autograd), –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–ª—É—á–∞–π–Ω—ã –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ–±—É—á–µ–Ω–∏—è. –ò—Ö —Ç–æ—á–Ω–∞—è —Ä–æ–ª—å —Å—Ç–∞–Ω–µ—Ç —è—Å–Ω–∞ –ø–æ—Å–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –Ω–æ —Å–µ–π—á–∞—Å –Ω–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –∏—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å:

```python
n_embd = 16     # embedding dimension
n_head = 4      # number of attention heads
n_layer = 1     # number of layers
block_size = 16 # maximum sequence length
head_dim = n_embd // n_head # dimension of each head
matrix = lambda nout, nin, std=0.08: [[Value(random.gauss(0, std)) for _ in range(nin)] for _ in range(nout)]
state_dict = {'wte': matrix(vocab_size, n_embd), 'wpe': matrix(block_size, n_embd), 'lm_head': matrix(vocab_size, n_embd)}
for i in range(n_layer):
    state_dict[f'layer{i}.attn_wq'] = matrix(n_embd, n_embd)
    state_dict[f'layer{i}.attn_wk'] = matrix(n_embd, n_embd)
    state_dict[f'layer{i}.attn_wv'] = matrix(n_embd, n_embd)
    state_dict[f'layer{i}.attn_wo'] = matrix(n_embd, n_embd)
    state_dict[f'layer{i}.mlp_fc1'] = matrix(4 * n_embd, n_embd)
    state_dict[f'layer{i}.mlp_fc2'] = matrix(n_embd, 4 * n_embd)
params = [p for mat in state_dict.values() for row in mat for p in row]
print(f"num params: {len(params)}")–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–ö–∞–∂–¥—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –º–∞–ª—ã–º —Å–ª—É—á–∞–π–Ω—ã–º —á–∏—Å–ª–æ–º –∏–∑ –≥–∞—É—Å—Å–æ–≤–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.

`state_dict` –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç –∏—Ö –≤ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ç—Ä–∏—Ü—ã (–ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å `PyTorch`): —Ç–∞–±–ª–∏—Ü—ã —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤, –≤–µ—Å–∞ –≤–Ω–∏–º–∞–Ω–∏—è, –≤–µ—Å–∞ MLP –∏ —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–µ–∫—Ü–∏—é –≤—ã–≤–æ–¥–∞. –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–∞–∫–∂–µ —Å–≤–µ–¥–µ–Ω—ã –≤ –æ–¥–∏–Ω —Å–ø–∏—Å–æ–∫ `params`, —á—Ç–æ–±—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –º–æ–≥ –ø–æ –Ω–∏–º –ø—Ä–æ–π—Ç–∏—Å—å.

–í –Ω–∞—à–µ–π –∫—Ä–æ—à–µ—á–Ω–æ–π –º–æ–¥–µ–ª–∏ ‚Äî 4192 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞. –£ GPT-2 ‚Äî 1,6 –º–∏–ª–ª–∏–∞—Ä–¥–∞, —É —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö LLM ‚Äî —Å–æ—Ç–Ω–∏ –º–∏–ª–ª–∏–∞—Ä–¥–æ–≤.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ú–æ–¥–µ–ª—å ‚Äî —ç—Ç–æ *—Ñ—É–Ω–∫—Ü–∏—è –±–µ–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è* **(**stateless function**)**: –æ–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–∫–µ–Ω, –ø–æ–∑–∏—Ü–∏—é, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª—é—á–µ–π/–∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —à–∞–≥–æ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç *–ª–æ–≥–∏—Ç—ã* ‚Äî –æ—Ü–µ–Ω–∫–∏ —Ç–æ–≥–æ, –∫–∞–∫–æ–π —Ç–æ–∫–µ–Ω, –ø–æ –º–Ω–µ–Ω–∏—é –º–æ–¥–µ–ª–∏, –¥–æ–ª–∂–µ–Ω –∏–¥—Ç–∏ —Å–ª–µ–¥—É—é—â–∏–º.

–ú—ã —Å–ª–µ–¥—É–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ GPT-2 —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ —É–ø—Ä–æ—â–µ–Ω–∏—è–º–∏: –∏—Å–ø–æ–ª—å–∑—É–µ–º `RMSNorm` –≤–º–µ—Å—Ç–æ `LayerNorm`, –Ω–µ—Ç —Å–º–µ—â–µ–Ω–∏–π (biases), –∏ `ReLU` –≤–º–µ—Å—Ç–æ `GeLU`.

–°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ç—Ä–∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

```python
def linear(x, w):
    return [sum(wi * xi for wi, xi in zip(wo, x)) for wo in w]–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

`linear`: —É–º–Ω–æ–∂–µ–Ω–∏–µ –º–∞—Ç—Ä–∏—Ü—ã –Ω–∞ –≤–µ–∫—Ç–æ—Ä. –û–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ –≤–µ–∫—Ç–æ—Ä `x` –∏ –º–∞—Ç—Ä–∏—Ü—É –≤–µ—Å–æ–≤ `w` –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç –æ–¥–Ω–æ —Å–∫–∞–ª—è—Ä–Ω–æ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ . –≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –±–ª–æ–∫ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π: –æ–±—É—á–∞–µ–º–æ–µ –ª–∏–Ω–µ–π–Ω–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ.

```python
def softmax(logits):
    max_val = max(val.data for val in logits)
    exps = [(val - max_val).exp() for val in logits]
    total = sum(exps)
    return [e / total for e in exps]–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

`softmax` –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤–µ–∫—Ç–æ—Ä –∏—Å—Ö–æ–¥–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫ (–ª–æ–≥–∏—Ç–æ–≤), –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç `‚àí‚àû` –¥–æ `+‚àû`, –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π: –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª–µ `[0,1]` –∏ –≤ —Å—É–º–º–µ –¥–∞—é—Ç 1. –î–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –≤–µ–ª–∏—á–∏–Ω –º—ã —Å–Ω–∞—á–∞–ª–∞ –≤—ã—á–∏—Ç–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç—Ç–æ –Ω–µ –º–µ–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏–∏ `exp`, —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç—ã).

```python
def rmsnorm(x):
    ms = sum(xi * xi for xi in x) / len(x)
    scale = (ms + 1e-5) ** -0.5
    return [xi * scale for xi in x]–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

`rmsnorm` (Root Mean Square Normalization, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Å—Ä–µ–¥–Ω–µ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é) –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç –≤–µ–∫—Ç–æ—Ä —Ç–∞–∫, —á—Ç–æ–±—ã –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ–ª–∏ –µ–¥–∏–Ω–∏—á–Ω–æ–µ —Å—Ä–µ–¥–Ω–µ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π —Ä–æ—Å—Ç –∏–ª–∏ –∑–∞—Ç—É—Ö–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–π –ø—Ä–∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ —á–µ—Ä–µ–∑ —Å–µ—Ç—å, —á—Ç–æ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è. –≠—Ç–æ —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç `LayerNorm`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º GPT-2.

–¢–µ–ø–µ—Ä—å —Å–∞–º–∞ –º–æ–¥–µ–ª—å:

```python
def gpt(token_id, pos_id, keys, values):
    tok_emb = state_dict['wte'][token_id] # token embedding
    pos_emb = state_dict['wpe'][pos_id] # position embedding
    x = [t + p for t, p in zip(tok_emb, pos_emb)] # joint token and position embedding
    x = rmsnorm(x)

    for li in range(n_layer):
        # 1) Multi-head attention block
        x_residual = x
        x = rmsnorm(x)
        q = linear(x, state_dict[f'layer{li}.attn_wq'])
        k = linear(x, state_dict[f'layer{li}.attn_wk'])
        v = linear(x, state_dict[f'layer{li}.attn_wv'])
        keys[li].append(k)
        values[li].append(v)
        x_attn = []
        for h in range(n_head):
            hs = h * head_dim
            q_h = q[hs:hs+head_dim]
            k_h = [ki[hs:hs+head_dim] for ki in keys[li]]
            v_h = [vi[hs:hs+head_dim] for vi in values[li]]
            attn_logits = [sum(q_h[j] * k_h[t][j] for j in range(head_dim)) / head_dim**0.5 for t in range(len(k_h))]
            attn_weights = softmax(attn_logits)
            head_out = [sum(attn_weights[t] * v_h[t][j] for t in range(len(v_h))) for j in range(head_dim)]
            x_attn.extend(head_out)
        x = linear(x_attn, state_dict[f'layer{li}.attn_wo'])
        x = [a + b for a, b in zip(x, x_residual)]
        # 2) MLP block
        x_residual = x
        x = rmsnorm(x)
        x = linear(x, state_dict[f'layer{li}.mlp_fc1'])
        x = [xi.relu() for xi in x]
        x = linear(x, state_dict[f'layer{li}.mlp_fc2'])
        x = [a + b for a, b in zip(x, x_residual)]

    logits = linear(x, state_dict['lm_head'])
    return logits–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω (—Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º `token_id`) –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤—Ä–µ–º–µ–Ω–Ω *–æ* –π –ø–æ–∑–∏—Ü–∏–∏ (`pos_id`), –∏—Å–ø–æ–ª—å–∑—É—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π, –æ–±–æ–±—â–µ–Ω–Ω—ã–π –≤ –∞–∫—Ç–∏–≤–∞—Ü–∏—è—Ö –∫–ª—é—á–µ–π `keys` –∏ –∑–Ω–∞—á–µ–Ω–∏–π `values`, –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ KV-–∫—ç—à.

–í–æ—Ç —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —à–∞–≥ –∑–∞ —à–∞–≥–æ–º:

**–≠–º–±–µ–¥–¥–∏–Ω–≥–∏ (Embeddings).** –ù–µ–π—Ä–æ—Å–µ—Ç—å –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å—ã—Ä–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–∫–µ–Ω–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä `5`. –û–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å –≤–µ–∫—Ç–æ—Ä–∞–º–∏ (—Å–ø–∏—Å–∫–∞–º–∏ —á–∏—Å–µ–ª). –ü–æ—ç—Ç–æ–º—É –º—ã —Å–≤—è–∑—ã–≤–∞–µ–º —Å –∫–∞–∂–¥—ã–º –≤–æ–∑–º–æ–∂–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º –æ–±—É—á–∞–µ–º—ã–π –≤–µ–∫—Ç–æ—Ä –∏ –ø–æ–¥–∞–µ–º –µ–≥–æ –≤ —Å–µ—Ç—å –∫–∞–∫ –µ–≥–æ –Ω–µ–π—Ä–æ–Ω–Ω—ã–π "—Å–∏–≥–Ω–∞—Ç—É—Ä–Ω—ã–π" –∫–æ–¥. –ò –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–∫–µ–Ω–∞, –∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–∑–∏—Ü–∏–∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç —Å—Ç—Ä–æ–∫—É –∏–∑ —Å–≤–æ–µ–π —Ç–∞–±–ª–∏—Ü—ã —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (`wte` –∏ `wpe` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ). –≠—Ç–∏ –¥–≤–∞ –≤–µ–∫—Ç–æ—Ä–∞ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è, –¥–∞–≤–∞—è –º–æ–¥–µ–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∫–æ–¥–∏—Ä—É–µ—Ç –∏ —Ç–æ, —á—Ç–æ —ç—Ç–æ –∑–∞ —Ç–æ–∫–µ–Ω, –∏ –≥–¥–µ –æ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ LLM –æ–±—ã—á–Ω–æ –æ—Ç–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –æ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –ø–æ–∑–∏—Ü–∏–∏ –≤ –ø–æ–ª—å–∑—É –¥—Ä—É–≥–∏—Ö —Å—Ö–µ–º, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–º –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, RoPE.

**–ë–ª–æ–∫ –≤–Ω–∏–º–∞–Ω–∏—è (Attention Block).** –¢–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω –ø—Ä–æ–µ—Ü–∏—Ä—É–µ—Ç—Å—è –≤ —Ç—Ä–∏ –≤–µ–∫—Ç–æ—Ä–∞: –∑–∞–ø—Ä–æ—Å (query, Q), –∫–ª—é—á (key, K) –∏ –∑–Ω–∞—á–µ–Ω–∏–µ (value, V). –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ, –∑–∞–ø—Ä–æ—Å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç: " *—á—Ç–æ —è –∏—â—É?*", –∫–ª—é—á –≥–æ–≤–æ—Ä–∏—Ç: " *—á—Ç–æ —è —Å–æ–¥–µ—Ä–∂—É?*", –∞ –∑–Ω–∞—á–µ–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç: " *—á—Ç–æ —è –ø—Ä–µ–¥–ª–∞–≥–∞—é, –µ—Å–ª–∏ –º–µ–Ω—è –≤—ã–±–µ—Ä—É—Ç?*".

–ù–∞–ø—Ä–∏–º–µ—Ä, –≤ –∏–º–µ–Ω–∏ "emma", –∫–æ–≥–¥–∞ –º–æ–¥–µ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ –≤—Ç–æ—Ä–æ–π –±—É–∫–≤–µ "m" –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ –±—É–¥–µ—Ç –¥–∞–ª—å—à–µ, –æ–Ω–∞ –º–æ–∂–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å –≤—Ä–æ–¥–µ: " *–∫–∞–∫–∏–µ –≥–ª–∞—Å–Ω—ã–µ –±—ã–ª–∏ –Ω–µ–¥–∞–≤–Ω–æ?*". –ë—É–∫–≤–∞ "e" —Ä–∞–Ω–µ–µ –±—É–¥–µ—Ç –∏–º–µ—Ç—å –∫–ª—é—á, —Ö–æ—Ä–æ—à–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç—Ç–æ–º—É –∑–∞–ø—Ä–æ—Å—É, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∞ –ø–æ–ª—É—á–∏—Ç –≤—ã—Å–æ–∫–∏–π –≤–µ—Å –≤–Ω–∏–º–∞–Ω–∏—è, –∏ –µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, —á—Ç–æ –æ–Ω–∞ –≥–ª–∞—Å–Ω–∞—è) –ø–µ—Ä–µ—Ç–µ—á–µ—Ç –Ω–∞ —Ç–µ–∫—É—â—É—é –ø–æ–∑–∏—Ü–∏—é.

–ö–ª—é—á –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ KV-–∫—ç—à, —á—Ç–æ–±—ã –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –±—ã–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã. –ö–∞–∂–¥–∞—è –≥–æ–ª–æ–≤–∞ –≤–Ω–∏–º–∞–Ω–∏—è –≤—ã—á–∏—Å–ª—è–µ—Ç —Å–∫–∞–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –º–µ–∂–¥—É —Å–≤–æ–∏–º –∑–∞–ø—Ä–æ—Å–æ–º –∏ –≤—Å–µ–º–∏ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ (–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –Ω–∞ ), –ø—Ä–∏–º–µ–Ω—è–µ—Ç `softmax` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–µ—Å–æ–≤ –≤–Ω–∏–º–∞–Ω–∏—è –∏ –±–µ—Ä–µ—Ç –≤–∑–≤–µ—à–µ–Ω–Ω—É—é —Å—É–º–º—É –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –í—ã—Ö–æ–¥—ã –≤—Å–µ—Ö –≥–æ–ª–æ–≤ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –∏ –ø—Ä–æ–µ—Ü–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `attn_wo`. –í–∞–∂–Ω–æ –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å, —á—Ç–æ –±–ª–æ–∫ –í–Ω–∏–º–∞–Ω–∏—è ‚Äî —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ, –≥–¥–µ —Ç–æ–∫–µ–Ω –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ –º–æ–∂–µ—Ç "–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å" –Ω–∞ —Ç–æ–∫–µ–Ω—ã –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ `(0..t-1)`. –í–Ω–∏–º–∞–Ω–∏–µ ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É —Ç–æ–∫–µ–Ω–∞–º–∏.

**–ë–ª–æ–∫ MLP.** MLP —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "multilayer perceptron, –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–π –ø–µ—Ä—Ü–µ–ø—Ç—Ä–æ–Ω". –≠—Ç–æ –¥–≤—É—Ö—Å–ª–æ–π–Ω–∞—è —Å–µ—Ç—å –ø—Ä—è–º–æ–≥–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è: –ø—Ä–æ–µ—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤ 4 —Ä–∞–∑–∞ –±–æ–ª—å—à–µ–µ —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ ReLU, –ø—Ä–æ–µ—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ. –ó–¥–µ—Å—å –º–æ–¥–µ–ª—å –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —á–∞—Å—Ç—å "—Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π" –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –≤–Ω–∏–º–∞–Ω–∏—è, —ç—Ç–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω—ã –¥–ª—è –º–æ–º–µ–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ `t`. –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä —á–µ—Ä–µ–¥—É–µ—Ç –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é (–í–Ω–∏–º–∞–Ω–∏–µ) —Å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º–∏ (MLP).

**–û—Å—Ç–∞—Ç–æ—á–Ω—ã–µ —Å–≤—è–∑–∏ (Residual Connections).** –ò –±–ª–æ–∫ –≤–Ω–∏–º–∞–Ω–∏—è, –∏ –±–ª–æ–∫ MLP –¥–æ–±–∞–≤–ª—è—é—Ç —Å–≤–æ–π –≤—ã—Ö–æ–¥ –æ–±—Ä–∞—Ç–Ω–æ –∫ —Å–≤–æ–µ–º—É –≤—Ö–æ–¥—É (`x = [a + b for ...]`). –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º —Ç–µ—á—å –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ —Å–µ—Ç—å –∏ –¥–µ–ª–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–º –æ–±—É—á–µ–Ω–∏–µ –≥–ª—É–±–æ–∫–∏—Ö –º–æ–¥–µ–ª–µ–π.

**–í—ã—Ö–æ–¥ (Output).** –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–∫—Ä—ã—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ—Ü–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ä–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è —Å –ø–æ–º–æ—â—å—é `lm_head`, —Å–æ–∑–¥–∞–≤–∞—è –ø–æ –æ–¥–Ω–æ–º—É –ª–æ–≥–∏—Ç—É –Ω–∞ –∫–∞–∂–¥—ã–π —Ç–æ–∫–µ–Ω –≤ —Å–ª–æ–≤–∞—Ä–µ. –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ —ç—Ç–æ –≤—Å–µ–≥–æ 27 —á–∏—Å–µ–ª. –ë–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π –ª–æ–≥–∏—Ç –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º–æ–¥–µ–ª—å —Å—á–∏—Ç–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ç–æ–∫–µ–Ω –±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–º —Å–ª–µ–¥—É—é—â–∏–º.

–í—ã –º–æ–≥–ª–∏ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º KV-–∫—ç—à –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è, —á—Ç–æ –Ω–µ–æ–±—ã—á–Ω–æ. –û–±—ã—á–Ω–æ KV-–∫—ç—à –∞—Å—Å–æ—Ü–∏–∏—Ä—É—é—Ç —Ç–æ–ª—å–∫–æ —Å –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–æ–º. –ù–æ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ KV-–∫—ç—à —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö –æ–Ω –ø—Ä–æ—Å—Ç–æ —Å–∫—Ä—ã—Ç –≤–Ω—É—Ç—Ä–∏ –≤—ã—Å–æ–∫–æ –≤–µ–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ. –ü–æ—Å–∫–æ–ª—å–∫—É `microgpt` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ –æ–¥–Ω–æ–º—É —Ç–æ–∫–µ–Ω—É –∑–∞ —Ä–∞–∑ (–Ω–µ—Ç —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ –±–∞—Ç—á–∞, –Ω–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω *—ã* —Ö —à–∞–≥–æ–≤), –º—ã —Å—Ç—Ä–æ–∏–º KV-–∫—ç—à —è–≤–Ω–æ. –ò, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç —Ç–∏–ø–∏—á–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞, –≥–¥–µ KV-–∫—ç—à —Ö—Ä–∞–Ω–∏—Ç "–æ—Ç—Å–æ–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ" —Ç–µ–Ω–∑–æ—Ä—ã, –∑–¥–µ—Å—å –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏ –∏ –∑–Ω–∞—á–µ–Ω–∏—è —è–≤–ª—è—é—Ç—Å—è "–∂–∏–≤—ã–º–∏" —É–∑–ª–∞–º–∏ Value –≤ –≥—Ä–∞—Ñ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π, –ø–æ—ç—Ç–æ–º—É –º—ã —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ–º –æ—à–∏–±–∫—É –æ–±—Ä–∞—Ç–Ω–æ —á–µ—Ä–µ–∑ –Ω–∏—Ö.

### –¶–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è

–¢–µ–ø–µ—Ä—å –≤—Å—ë —Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ. –¶–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —ç—Ç–∞–ø–æ–≤:

1. –í—ã–±–æ—Ä –¥–æ–∫—É–º–µ–Ω—Ç–∞
2. –ü—Ä—è–º–æ–π –ø—Ä–æ—Ö–æ–¥ –º–æ–¥–µ–ª–∏ –ø–æ —Ç–æ–∫–µ–Ω–∞–º
3. –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –≤–µ–ª–∏—á–∏–Ω—ã –ø–æ—Ç–µ—Ä–∏
4. –û–±—Ä–∞—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã)
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
```python
# Let there be Adam, the blessed optimizer and its buffers
learning_rate, beta1, beta2, eps_adam = 0.01, 0.85, 0.99, 1e-8
m = [0.0] * len(params) # first moment buffer
v = [0.0] * len(params) # second moment buffer

# Repeat in sequence
num_steps = 1000 # number of training steps
for step in range(num_steps):

    # Take single document, tokenize it, surround it with BOS special token on both sides
    doc = docs[step % len(docs)]
    tokens = [BOS] + [uchars.index(ch) for ch in doc] + [BOS]
    n = min(block_size, len(tokens) - 1)

    # Forward the token sequence through the model, building up the computation graph all the way to the loss.
    keys, values = [[] for _ in range(n_layer)], [[] for _ in range(n_layer)]
    losses = []
    for pos_id in range(n):
        token_id, target_id = tokens[pos_id], tokens[pos_id + 1]
        logits = gpt(token_id, pos_id, keys, values)
        probs = softmax(logits)
        loss_t = -probs[target_id].log()
        losses.append(loss_t)
    loss = (1 / n) * sum(losses) # final average loss over the document sequence. May yours be low.

    # Backward the loss, calculating the gradients with respect to all model parameters.
    loss.backward()

    # Adam optimizer update: update the model parameters based on the corresponding gradients.
    lr_t = learning_rate * (1 - step / num_steps) # linear learning rate decay
    for i, p in enumerate(params):
        m[i] = beta1 * m[i] + (1 - beta1) * p.grad
        v[i] = beta2 * v[i] + (1 - beta2) * p.grad ** 2
        m_hat = m[i] / (1 - beta1 ** (step + 1))
        v_hat = v[i] / (1 - beta2 ** (step + 1))
        p.data -= lr_t * m_hat / (v_hat ** 0.5 + eps_adam)
        p.grad = 0

    print(f"step {step+1:4d} / {num_steps:4d} | loss {loss.data:.4f}")–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–î–∞–≤–∞–π—Ç–µ –ø—Ä–æ–π–¥—ë–º—Å—è –ø–æ –∫–∞–∂–¥–æ–º—É —ç—Ç–∞–ø—É:

**–¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è.** –ù–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –æ–±—É—á–µ–Ω–∏—è –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –æ–¥–∏–Ω –¥–æ–∫—É–º–µ–Ω—Ç, –æ–Ω –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ–∫–µ–Ω–∞–º–∏ BOS (–Ω–∞—á–∞–ª–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏) —Å –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω: –∏–º—è "emma" –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ `[BOS, e, m, m, a, BOS]`. –ó–∞–¥–∞—á–∞ –º–æ–¥–µ–ª–∏ ‚Äî –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –∫–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π —Ç–æ–∫–µ–Ω, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö.

**–ü—Ä—è–º–æ–π –ø—Ä–æ—Ö–æ–¥ –∏ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å (Forward pass and loss).** –ú—ã –ø–æ–¥–∞–µ–º —Ç–æ–∫–µ–Ω—ã –≤ –º–æ–¥–µ–ª—å –ø–æ –æ–¥–Ω–æ–º—É, –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –Ω–∞–ø–æ–ª–Ω—è—è KV-–∫—ç—à. –ù–∞ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ –º–æ–¥–µ–ª—å –≤—ã–¥–∞–µ—Ç 27 –ª–æ–≥–∏—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é `softmax`. –ü–æ—Ç–µ—Ä—è (–æ—à–∏–±–∫–∞) –Ω–∞ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∫–∞–∫ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –ª–æ–≥–∞—Ä–∏—Ñ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞: . –≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫—Ä–æ—Å—Å-—ç–Ω—Ç—Ä–æ–ø–∏–π–Ω–æ–π –ø–æ—Ç–µ—Ä–µ–π (cross-entropy loss). –ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ, –ø–æ—Ç–µ—Ä—è –∏–∑–º–µ—Ä—è–µ—Ç —Å—Ç–µ–ø–µ–Ω—å –æ—à–∏–±–∫–∏ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è: –Ω–∞—Å–∫–æ–ª—å–∫–æ –º–æ–¥–µ–ª—å "—É–¥–∏–≤–ª–µ–Ω–∞" —Ç–µ–º, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ. –ï—Å–ª–∏ –º–æ–¥–µ–ª—å –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Ç–æ–∫–µ–Ω—É –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å 1.0, –æ–Ω–∞ –Ω–∏—Å–∫–æ–ª—å–∫–æ –Ω–µ —É–¥–∏–≤–ª–µ–Ω–∞, –∏ –ø–æ—Ç–µ—Ä—è —Ä–∞–≤–Ω–∞ 0. –ï—Å–ª–∏ –æ–Ω–∞ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å, –±–ª–∏–∑–∫—É—é –∫ 0, –º–æ–¥–µ–ª—å –æ—á–µ–Ω—å —É–¥–∏–≤–ª–µ–Ω–∞, –∏ –ø–æ—Ç–µ—Ä—è —Å—Ç—Ä–µ–º–∏—Ç—Å—è –∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏. –ú—ã —É—Å—Ä–µ–¥–Ω—è–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Ç–µ—Ä—å –ø–æ –≤—Å–µ–º –ø–æ–∑–∏—Ü–∏—è–º –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–∫–∞–ª—è—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä–∏.

**–û–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ—Ö–æ–¥ (Backward pass).** –û–¥–∏–Ω –≤—ã–∑–æ–≤ `loss.backward()` –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ –≤–µ—Å—å –≥—Ä–∞—Ñ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π: –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ—Ç–µ—Ä–∏, —á–µ—Ä–µ–∑ `softmax`, —á–µ—Ä–µ–∑ –≤—Å—é –º–æ–¥–µ–ª—å –∏ –≤–ø–ª–æ—Ç—å –¥–æ –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç `.grad` –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–º, –∫–∞–∫ –µ–≥–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å, —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å –ø–æ—Ç–µ—Ä—é.

**–û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä Adam (Adam optimizer).** –ú—ã –º–æ–≥–ª–∏ –±—ã –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å `p.data -= lr * p.grad` (–≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Å–ø—É—Å–∫), –Ω–æ Adam —Ä–∞–±–æ—Ç–∞–µ—Ç —É–º–Ω–µ–µ. –û–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ —Å–∫–æ–ª—å–∑—è—â–∏—Ö —Å—Ä–µ–¥–Ω–∏—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞: `m` –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ–¥–∞–≤–Ω–∏—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ (–∏–º–ø—É–ª—å—Å, momentum ‚Äî –∫–∞–∫ –∫–∞—Ç—è—â–∏–π—Å—è —à–∞—Ä), –∞ `v` –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–æ–≤ –Ω–µ–¥–∞–≤–Ω–∏—Ö –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ (–∞–¥–∞–ø—Ç–∏—Ä—É—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞). –ó–Ω–∞—á–µ–Ω–∏—è `m_hat` –∏ `v_hat` ‚Äî —ç—Ç–æ —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç —Å–º–µ—â–µ–Ω–∏—è –æ—Ü–µ–Ω–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ —É—á–∏—Ç—ã–≤–∞—é—Ç, —á—Ç–æ `m` –∏ `v` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –Ω—É–ª—è–º–∏ –∏ –∏–º –Ω—É–∂–µ–Ω "—Ä–∞–∑–æ–≥—Ä–µ–≤". –°–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è –ª–∏–Ω–µ–π–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏. –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º—ã —Å–±—Ä–∞—Å—ã–≤–∞–µ–º `.grad` –≤ 0 –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞.

–ó–∞ 1000 —à–∞–≥–æ–≤ –æ–±—É—á–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä–∏ —Å–Ω–∏–∂–∞–µ—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ —Å 3.3 (—Å–ª—É—á–∞–π–Ω–æ–µ —É–≥–∞–¥—ã–≤–∞–Ω–∏–µ —Å—Ä–µ–¥–∏ 27 —Ç–æ–∫–µ–Ω–æ–≤: `-log(1/27) ‚âà 3.3`) –¥–æ –ø—Ä–∏–º–µ—Ä–Ω–æ `2.37`. –ú–µ–Ω—å—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ª—É—á—à–µ, –∏ —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–π –º–∏–Ω–∏–º—É–º ‚Äî 0 (–∏–¥–µ–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è), —Ç–∞–∫ —á—Ç–æ –µ—â–µ –µ—Å—Ç—å –∫—É–¥–∞ —Å—Ç—Ä–µ–º–∏—Ç—å—Å—è, –Ω–æ –º–æ–¥–µ–ª—å –∏ –ø—Ä–∏ —Ç–∞–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö –ø–æ—Ç–µ—Ä–∏ —è–≤–Ω–æ –∏–∑—É—á–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏, –ø—Ä–∏—Å—É—â–∏–µ –∏–º–µ–Ω–∞–º.

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è, –≤—ã–≤–æ–¥ (Inference)

–ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è –º–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∏–º–µ–Ω–∞. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã, –∏ –º—ã –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä—è–º–æ–π –ø—Ä–æ—Ö–æ–¥ –≤ —Ü–∏–∫–ª–µ, –ø–æ–¥–∞–≤–∞—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –∫–∞–∫ —Å–ª–µ–¥—É—é—â–∏–π –≤—Ö–æ–¥:

```python
temperature = 0.5 # in (0, 1], control the "creativity" of generated text, low to high
print("\n--- inference (new, hallucinated names) ---")
for sample_idx in range(20):
    keys, values = [[] for _ in range(n_layer)], [[] for _ in range(n_layer)]
    token_id = BOS
    sample = []
    for pos_id in range(block_size):
        logits = gpt(token_id, pos_id, keys, values)
        probs = softmax([l / temperature for l in logits])
        token_id = random.choices(range(vocab_size), weights=[p.data for p in probs])[0]
        if token_id == BOS:
            break
        sample.append(uchars[token_id])
    print(f"sample {sample_idx+1:2d}: {''.join(sample)}")–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–ö–∞–∂–¥—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –º—ã –Ω–∞—á–∏–Ω–∞–µ–º —Å —Ç–æ–∫–µ–Ω–∞ `BOS`, –∫–æ—Ç–æ—Ä—ã–π –≥–æ–≤–æ—Ä–∏—Ç –º–æ–¥–µ–ª–∏: "–Ω–∞—á–Ω–∏ –Ω–æ–≤–æ–µ –∏–º—è". –ú–æ–¥–µ–ª—å –≤—ã–¥–∞–µ—Ç 27 –ª–æ–≥–∏—Ç–æ–≤, –º—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∏—Ö –≤ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∏ —Å–ª—É—á–∞–π–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –≤—ã–±–∏—Ä–∞–µ–º –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —ç—Ç–∏–º–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏. –≠—Ç–æ—Ç —Ç–æ–∫–µ–Ω —Å–Ω–æ–≤–∞ –ø–æ–¥–∞–µ—Ç—Å—è –Ω–∞ –≤—Ö–æ–¥ –∫–∞–∫ —Å–ª–µ–¥—É—é—â–∏–π, –∏ –º—ã –ø–æ–≤—Ç–æ—Ä—è–µ–º –ø—Ä–æ—Ü–µ—Å—Å –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –º–æ–¥–µ–ª—å –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω `BOS` (–æ–∑–Ω–∞—á–∞—é—â–∏–π " *—è –∑–∞–∫–æ–Ω—á–∏–ª–∞* ") –∏–ª–∏ –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

–ü–∞—Ä–∞–º–µ—Ç—Ä *—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (temperature)* –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Å—Ç–µ–ø–µ–Ω—å —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏. –ü–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º `softmax` –º—ã –¥–µ–ª–∏–º –ª–æ–≥–∏—Ç—ã –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã. –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, —Ä–∞–≤–Ω–∞—è `1,0`, –æ–∑–Ω–∞—á–∞–µ—Ç —Å—ç–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã—É—á–∏–ª–∞ –º–æ–¥–µ–ª—å. –ë–æ–ª–µ–µ –Ω–∏–∑–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `0,5`, –∫–∞–∫ –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ) –¥–µ–ª–∞—é—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª–µ–µ "–æ—Å—Ç—Ä—ã–º" (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Å–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞—Ö), —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –±–æ–ª–µ–µ –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é –º–æ–¥–µ–ª–∏, –∫–æ–≥–¥–∞ –æ–Ω–∞ —Å –±–æ–ª—å—à–µ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é –≤—ã–±–∏—Ä–∞–µ—Ç —Å–≤–æ–∏ –ª—É—á—à–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã. –ü—Ä–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ, —Å—Ç—Ä–µ–º—è—â–µ–π—Å—è –∫ –Ω—É–ª—é, –º–æ–¥–µ–ª—å –≤—Å–µ–≥–¥–∞ –±—É–¥–µ—Ç –≤—ã–±–∏—Ä–∞—Ç—å —Å–∞–º—ã–π –≤–µ—Ä–æ—è—Ç–Ω—ã–π —Ç–æ–∫–µ–Ω (—ç—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∂–∞–¥–Ω—ã–º –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º). –ë–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã, –Ω–∞–æ–±–æ—Ä–æ—Ç, —Å–≥–ª–∞–∂–∏–≤–∞—é—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, –¥–µ–ª–∞—è –≤—ã–≤–æ–¥ –±–æ–ª–µ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–º, –Ω–æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –º–µ–Ω–µ–µ —Å–≤—è–∑–Ω—ã–º.

### –ó–∞–ø—É—Å—Ç–∏–º –∫–æ–¥

–í—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ ‚Äî Python (–±–µ–∑ pip, –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π):

```python
python train.py–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

(–µ—Å–ª–∏ –º—ã –Ω–∞–∑–æ–≤—ë–º —Ñ–∞–π–ª train.py)

–°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è ~1 –º–∏–Ω—É—Ç—É –Ω–∞ MacBook. –í—ã —É–≤–∏–¥–∏—Ç–µ, –∫–∞–∫ –≤–µ–ª–∏—á–∏–Ω—É –ø–æ—Ç–µ—Ä—å, loss –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ:

```python
train.py
num docs: 32033
vocab size: 27
num params: 4192
step    1 / 1000 | loss 3.3660
step    2 / 1000 | loss 3.4243
step    3 / 1000 | loss 3.1778
step    4 / 1000 | loss 3.0664
step    5 / 1000 | loss 3.2209
step    6 / 1000 | loss 2.9452
step    7 / 1000 | loss 3.2894
step    8 / 1000 | loss 3.3245
step    9 / 1000 | loss 2.8990
step   10 / 1000 | loss 3.2229
step   11 / 1000 | loss 2.7964
step   12 / 1000 | loss 2.9345
step   13 / 1000 | loss 3.0544
...–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–£–≤–∏–¥–∏—Ç–µ, –∫–∞–∫ –æ–Ω–∞ –ø–∞–¥–∞–µ—Ç —Å ~3.3 (—Å–ª—É—á–∞–π–Ω—ã–π —Ç–æ–∫–µ–Ω) –¥–æ ~2.37. –ß–µ–º –Ω–∏–∂–µ ‚Äî —Ç–µ–º –ª—É—á—à–µ –º–æ–¥–µ–ª—å –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ç–æ–∫–µ–Ω.

–í –∫–æ–Ω—Ü–µ –æ–±—É—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–Ω–∞–Ω–∏—è –æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—è—Ö –∏–º—ë–Ω. –ò—Å–ø–æ–ª—å–∑—É—è –∏—Ö, –º–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ, ¬´–≥–∞–ª–ª—é—Ü–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ¬ª –∏–º–µ–Ω–∞.

–í—ã —É–≤–∏–¥–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–∏–µ –∏–º–µ–Ω–∞:

```python
sample  1: kamon
sample  2: ann
sample  3: karai
sample  4: jaire
sample  5: vialan
sample  6: karia
sample  7: yeran
sample  8: anna
sample  9: areli
sample 10: kaina
sample 11: konna
sample 12: keylen
sample 13: liole
sample 14: alerin
sample 15: earan
sample 16: lenne
sample 17: kana
sample 18: lara
sample 19: alela
sample 20: anton–û–±—ä—è—Å–Ω–∏—Ç—å —Å
```

–í—ã –º–æ–∂–µ—Ç–µ:

- –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Å–≤–æ—ë–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [Google Colab notebook](https://colab.research.google.com/drive/1vyN5zo6rqUp_dYNbT4Yrco66zuWCZKoN?usp=sharing) –∏ –∑–∞–¥–∞—Ç—å Gemini –≤–æ–ø—Ä–æ—Å—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ–¥–∞
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å: –¥—Ä—É–≥–æ–π –¥–∞—Ç–∞—Å–µ—Ç, –±–æ–ª—å—à–µ —à–∞–≥–æ–≤ `num_steps`, —É–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–∑—É—á–µ–Ω–∏—è –∫–æ–¥–∞

–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å, –∫–∞–∫ –∫–æ–¥ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ —á–∞—Å—Ç—è–º, —Å–ª–æ–≤–Ω–æ —Å–ª–æ–∏ –ª—É–∫–æ–≤–∏—Ü—ã, —Ä–µ–∫–æ–º–µ–Ω–¥—É—é —Ç–∞–∫—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–∑—É—á–µ–Ω–∏—è:

| –§–∞–π–ª | –ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è |
| --- | --- |
| `train0.py` | –¢–∞–±–ª–∏—Ü–∞ —á–∞—Å—Ç–æ—Ç –±–∏–≥—Ä–∞–º–º ‚Äî –±–µ–∑ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏, –±–µ–∑ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ |
| `train1.py` | MLP + –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã, –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –≤—Ä—É—á–Ω—É—é (—á–∏—Å–ª–µ–Ω–Ω–æ –∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏) + SGD |
| `train2.py` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ (Autograd) (–∫–ª–∞—Å—Å `Value`) ‚Äî –∑–∞–º–µ–Ω—è–µ—Ç —Ä—É—á–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤ |
| `train3.py` | –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ –ø–æ–∑–∏—Ü–∏–π (Position embeddings) + –≤–Ω–∏–º–∞–Ω–∏–µ —Å –æ–¥–Ω–æ–π –≥–æ–ª–æ–≤–æ–π (single-head attention) + RMSNorm + –æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ —Å–≤—è–∑–∏ (residuals) |
| `train4.py` | –ú–Ω–æ–≥–æ–≥–æ–ª–æ–≤–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ (Multi-head attention) + —Ü–∏–∫–ª –ø–æ —Å–ª–æ—è–º ‚Äî –ø–æ–ª–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ GPT |
| `train5.py` | –û–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä Adam ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π [`train.py`](http://train.py/) |

–Ø —Å–æ–∑–¥–∞–ª Gist –ø–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–µ–º [`build_microgpt.py`](https://gist.github.com/karpathy/561ac2de12a47cc06a23691e1be9543a), –≥–¥–µ –≤ —Ä–∞–∑–¥–µ–ª–µ "Revisions" (–ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π) –≤—ã –º–æ–∂–µ—Ç–µ —É–≤–∏–¥–µ—Ç—å –≤—Å–µ —ç—Ç–∏ –≤–µ—Ä—Å–∏–∏ –∏ —Ä–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –∫–∞–∂–¥—ã–º —à–∞–≥–æ–º. –î—É–º–∞—é, —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ, –¥–æ–±–∞–≤–ª—è—è –ø–æ –æ–¥–Ω–æ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É –∑–∞ —Ä–∞–∑.

## –†–µ–∞–ª—å–Ω—ã–µ –º–∞—Å—à—Ç–∞–±—ã

`microgpt` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫—É—é —Å—É—Ç—å –æ–±—É—á–µ–Ω–∏—è –∏ —Ä–∞–±–æ—Ç—ã GPT. –ù–æ –º–µ–∂–¥—É –Ω–∏–º –∏ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–π LLM, —Ç–∞–∫–æ–π –∫–∞–∫ ChatGPT, –ª–µ–∂–∏—Ç –¥–ª–∏–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —É—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–∏–π. –ù–∏ –æ–¥–Ω–æ –∏–∑ –Ω–∏—Ö –Ω–µ –º–µ–Ω—è–µ—Ç –±–∞–∑–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –∏ –æ–±—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –Ω–æ –∏–º–µ–Ω–Ω–æ –æ–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç —Å–∏—Å—Ç–µ–º–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –º–∞—Å—à—Ç–∞–±–µ. –ü—Ä–æ–π–¥–µ–º—Å—è –ø–æ —Ç–µ–º –∂–µ —Ä–∞–∑–¥–µ–ª–∞–º –ø–æ –ø–æ—Ä—è–¥–∫—É:

**–î–∞–Ω–Ω—ã–µ (Data).** –í–º–µ—Å—Ç–æ 32 —Ç—ã—Å—è—á –∫–æ—Ä–æ—Ç–∫–∏—Ö –∏–º–µ–Ω, –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –æ–±—É—á–∞—é—Ç—Å—è –Ω–∞ —Ç—Ä–∏–ª–ª–∏–æ–Ω–∞—Ö —Ç–æ–∫–µ–Ω–æ–≤ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞: –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã, –∫–Ω–∏–≥–∏, –∫–æ–¥ –∏ —Ç.–¥. –î–∞–Ω–Ω—ã–µ –¥–µ–¥—É–±–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è, —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –∏ —Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞—é—Ç—Å—è –ø–æ –¥–æ–º–µ–Ω–∞–º.

**–¢–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä (Tokenizer).** –í–º–µ—Å—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤, –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä—ã –ø–æ–¥—Å–ª–æ–≤, —Ç–∞–∫–∏–µ –∫–∞–∫ BPE (Byte Pair Encoding), –∫–æ—Ç–æ—Ä—ã–µ —É—á–∞—Ç—Å—è –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏–º–≤–æ–ª–æ–≤ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã. –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞, —Ç–∞–∫–∏–µ –∫–∞–∫ "the", —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –æ–¥–Ω–∏–º —Ç–æ–∫–µ–Ω–æ–º, —Ä–µ–¥–∫–∏–µ —Å–ª–æ–≤–∞ —Ä–∞–∑–±–∏–≤–∞—é—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏. –≠—Ç–æ –¥–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å –ø—Ä–∏–º–µ—Ä–Ω–æ –∏–∑ 100 —Ç—ã—Å—è—á —Ç–æ–∫–µ–Ω–æ–≤ –∏ –≥–æ—Ä–∞–∑–¥–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –º–æ–¥–µ–ª—å –≤–∏–¥–∏—Ç –±–æ–ª—å—à–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏.

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ (Autograd).**`microgpt` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å–∫–∞–ª—è—Ä–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ `Value` –Ω–∞ —á–∏—Å—Ç–æ–º Python. –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–µ–Ω–∑–æ—Ä—ã (–±–æ–ª—å—à–∏–µ –º–Ω–æ–≥–æ–º–µ—Ä–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã —á–∏—Å–µ–ª) –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ GPU/TPU, –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö –º–∏–ª–ª–∏–∞—Ä–¥—ã –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–ª–∞–≤–∞—é—â–µ–π –∑–∞–ø—è—Ç–æ–π –≤ —Å–µ–∫—É–Ω–¥—É. –¢–∞–∫–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –∫–∞–∫ PyTorch, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ç–µ–Ω–∑–æ—Ä–æ–≤, –∞ —è–¥—Ä–∞ CUDA, —Ç–∞–∫–∏–µ –∫–∞–∫ FlashAttention, –æ–±—ä–µ–¥–∏–Ω—è—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏. –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–∞, –ø—Ä–æ—Å—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤—É —Å–∫–∞–ª—è—Ä–æ–≤, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Architecture).** –£ `microgpt` 4192 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞. –ú–æ–¥–µ–ª–∏ –∫–ª–∞—Å—Å–∞ GPT-4 –∏–º–µ—é—Ç —Å–æ—Ç–Ω–∏ –º–∏–ª–ª–∏–∞—Ä–¥–æ–≤. –í —Ü–µ–ª–æ–º —ç—Ç–æ –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∞—è –Ω–µ–π—Ä–æ—Å–µ—Ç—å-—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä, —Ç–æ–ª—å–∫–æ –Ω–∞–º–Ω–æ–≥–æ —à–∏—Ä–µ (—Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ 10000+) –∏ –Ω–∞–º–Ω–æ–≥–æ –≥–ª—É–±–∂–µ (100+ —Å–ª–æ–µ–≤). –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ LLM —Ç–∞–∫–∂–µ –≤–∫–ª—é—á–∞—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ "–∫–∏—Ä–ø–∏—á–∏–∫–æ–≤" –∏ –º–µ–Ω—è—é—Ç –∏—Ö –ø–æ—Ä—è–¥–æ–∫. –ü—Ä–∏–º–µ—Ä—ã: RoPE (Rotary Position Embeddings ‚Äî –≤—Ä–∞—â–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏) –≤–º–µ—Å—Ç–æ –æ–±—É—á–∞–µ–º—ã—Ö –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤, GQA (Grouped Query Attention ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤) –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ KV-–∫—ç—à–∞, –∑–∞—Ç–≤–æ—Ä–Ω—ã–µ –ª–∏–Ω–µ–π–Ω—ã–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (gated linear units) –≤–º–µ—Å—Ç–æ ReLU, —Å–ª–æ–∏ —Å–º–µ—Å–∏ —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ (MoE ‚Äî Mixture of Experts) –∏ —Ç.–¥. –ù–æ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ–º –í–Ω–∏–º–∞–Ω–∏—è (–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è) –∏ MLP (–≤—ã—á–∏—Å–ª–µ–Ω–∏—è) –Ω–∞ –æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –ø–æ—Ç–æ–∫–µ (residual stream) —Ö–æ—Ä–æ—à–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.

**–û–±—É—á–µ–Ω–∏–µ (Training).** –í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∑–∞ —à–∞–≥, –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–æ–ª—å—à–∏–µ –±–∞—Ç—á–∏ (–º–∏–ª–ª–∏–æ–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤ –∑–∞ —à–∞–≥), –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ (gradient accumulation), —Å–º–µ—à–∞–Ω–Ω—É—é —Ç–æ—á–Ω–æ—Å—Ç—å (float16/bfloat16) –∏ —Ç—â–∞—Ç–µ–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –û–±—É—á–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–æ–≤–æ–π –º–æ–¥–µ–ª–∏ —Ç—Ä–µ–±—É–µ—Ç —Ç—ã—Å—è—á GPU, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –º–µ—Å—è—Ü–∞–º–∏.

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (Optimization).** –í `microgpt` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Adam —Å –ø—Ä–æ—Å—Ç—ã–º –ª–∏–Ω–µ–π–Ω—ã–º –∑–∞—Ç—É—Ö–∞–Ω–∏–µ–º —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ–±—É—á–µ–Ω–∏—è, –∏ –Ω–∞ —ç—Ç–æ–º –≤—Å—ë. –í –º–∞—Å—à—Ç–∞–±–Ω–æ–º —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–æ–π. –ú–æ–¥–µ–ª–∏ –æ–±—É—á–∞—é—Ç—Å—è —Å –ø–æ–Ω–∏–∂–µ–Ω–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é (bfloat16 –∏–ª–∏ –¥–∞–∂–µ fp8) –∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö GPU –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —Å–≤–æ–∏ —á–∏—Å–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞ (—Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞—Ç—É—Ö–∞–Ω–∏—è –≤–µ—Å–æ–≤ (weight decay), –ø–∞—Ä–∞–º–µ—Ç—Ä—ã beta, –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–∑–æ–≥—Ä–µ–≤–∞ (warmup), –≥—Ä–∞—Ñ–∏–∫ –∑–∞—Ç—É—Ö–∞–Ω–∏—è) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ—á–Ω–æ –ø–æ–¥–æ–±—Ä–∞–Ω—ã, –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –º–æ–¥–µ–ª–∏, —Ä–∞–∑–º–µ—Ä–∞ –±–∞—Ç—á–∞ –∏ —Å–æ—Å—Ç–∞–≤–∞ –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö. –ó–∞–∫–æ–Ω—ã –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, Chinchilla) –ø–æ–º–æ–≥–∞—é—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–π –±—é–¥–∂–µ—Ç –º–µ–∂–¥—É —Ä–∞–∑–º–µ—Ä–æ–º –º–æ–¥–µ–ª–∏ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ç–æ–∫–µ–Ω–æ–≤ –æ–±—É—á–µ–Ω–∏—è. –û—à–∏–±–∫–∞ –≤ –ª—é–±–æ–π –∏–∑ —ç—Ç–∏—Ö –¥–µ—Ç–∞–ª–µ–π –≤ –º–∞—Å—à—Ç–∞–±–µ –º–æ–∂–µ—Ç —Å—Ç–æ–∏—Ç—å –º–∏–ª–ª–∏–æ–Ω–æ–≤ –¥–æ–ª–ª–∞—Ä–æ–≤ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤, –ø–æ—ç—Ç–æ–º—É –∫–æ–º–∞–Ω–¥—ã –ø—Ä–æ–≤–æ–¥—è—Ç –æ–±—à–∏—Ä–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã –Ω–∞ –º–µ–Ω—å—à–∏—Ö –º–∞—Å—à—Ç–∞–±–∞—Ö, —á—Ç–æ–±—ã –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –ø—Ä–µ–∂–¥–µ —á–µ–º –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–ª–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ.

**–ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ (Post-training).** –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å, –ø–æ–ª—É—á–∞–µ–º–∞—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –æ–±—É—á–µ–Ω–∏—è (–Ω–∞–∑—ã–≤–∞–µ–º–∞—è "–ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–æ–π" –º–æ–¥–µ–ª—å—é), —è–≤–ª—è–µ—Ç—Å—è "–∑–∞–≤–µ—Ä—à–∞—Ç–µ–ª–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤", –∞ –Ω–µ —á–∞—Ç-–±–æ—Ç–æ–º. –ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –µ–µ –≤ ChatGPT –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –¥–≤–∞ —ç—Ç–∞–ø–∞. –ü–µ—Ä–≤—ã–π ‚Äî SFT (Supervised Fine-Tuning, –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –¥–æ–Ω–∞—Å—Ç—Ä–æ–π–∫–∞): –≤—ã –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω—è–µ—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω–∞ –ø–æ–¥–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç–µ –æ–±—É—á–µ–Ω–∏–µ. –ê–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è. –í—Ç–æ—Ä–æ–π ‚Äî RL (Reinforcement Learning, –æ–±—É—á–µ–Ω–∏–µ —Å –ø–æ–¥–∫—Ä–µ–ø–ª–µ–Ω–∏–µ–º): –º–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã, –æ–Ω–∏ –ø–æ–ª—É—á–∞—é—Ç –æ—Ü–µ–Ω–∫—É (–æ—Ç –ª—é–¥–µ–π, –¥—Ä—É–≥–æ–π –º–æ–¥–µ–ª–∏-"—Å—É–¥—å–∏" –∏–ª–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞), –∏ –º–æ–¥–µ–ª—å —É—á–∏—Ç—Å—è –Ω–∞ —ç—Ç–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏. –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ –º–æ–¥–µ–ª—å –≤—Å–µ –µ—â–µ –æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö, –Ω–æ —Ç–µ–ø–µ—Ä—å —ç—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã —Å–æ—Å—Ç–æ—è—Ç –∏–∑ —Ç–æ–∫–µ–Ω–æ–≤, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∞–º–æ–π –º–æ–¥–µ–ª—å—é.

**–ò–Ω—Ñ–µ—Ä–µ–Ω—Å (Inference).** –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –º–∏–ª–ª–∏–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç—Ä–µ–±—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π: –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –±–∞—Ç—á–∏ (batching), —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ KV-–∫—ç—à–µ–º –∏ –µ–≥–æ —Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è (vLLM –∏ —Ç.–¥.), —Å–ø–µ–∫—É–ª—è—Ç–∏–≤–Ω–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (speculative decoding) –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏, –∫–≤–∞–Ω—Ç–∏–∑–∞—Ü–∏—è (—Ä–∞–±–æ—Ç–∞ –≤ int8/int4 –≤–º–µ—Å—Ç–æ float16) –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º GPU. –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ –º—ã –≤—Å—ë –µ—â–µ –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —Ç–æ–∫–µ–Ω –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –Ω–æ —Å –º–∞—Å—Å–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã—Ö —É—Ö–∏—â—Ä–µ–Ω–∏–π, —á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å —ç—Ç–æ –±—ã—Å—Ç—Ä–µ–µ.

–í—Å–µ —ç—Ç–æ ‚Äî –≤–∞–∂–Ω—ã–µ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, –Ω–æ –µ—Å–ª–∏ –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ `microgpt`, –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–µ—Å–∫—É—é —Å—É—Ç—å.

### FAQ

*–ü–æ–Ω–∏–º–∞–µ—Ç –ª–∏ –º–æ–¥–µ–ª—å —á—Ç–æ-–ª–∏–±–æ?*

–≠—Ç–æ —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–π –≤–æ–ø—Ä–æ—Å, –Ω–æ —Å –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –Ω–∏–∫–∞–∫–æ–π –º–∞–≥–∏–∏ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç. –ú–æ–¥–µ–ª—å ‚Äî —ç—Ç–æ –±–æ–ª—å—à–∞—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–æ–∫–µ–Ω–∞. –í–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —Ç–∞–∫, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ª–µ–¥—É—é—â–∏–π —Ç–æ–∫–µ–Ω –±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—ã–º. –°–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ª–∏ —ç—Ç–æ "–ø–æ–Ω–∏–º–∞–Ω–∏–µ" ‚Äî —Ä–µ—à–∞—Ç—å –≤–∞–º, –Ω–æ –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø–∏—Å–∞–Ω –≤ 200 —Å—Ç—Ä–æ–∫–∞—Ö –∫–æ–¥–∞ –≤—ã—à–µ.

*–ü–æ—á–µ–º—É —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?*

–£ –º–æ–¥–µ–ª–∏ —Ç—ã—Å—è—á–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –Ω–µ–º–Ω–æ–≥–æ –∏–∑–º–µ–Ω—è–µ—Ç –∏—Ö –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ, —á—Ç–æ–±—ã —É–º–µ–Ω—å—à–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å. –ó–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç—Ä–∞–∂–∞—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö. –î–ª—è –∏–º–µ–Ω —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä: –∏–º–µ–Ω–∞ —á–∞—Å—Ç–æ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å —Å–æ–≥–ª–∞—Å–Ω—ã—Ö, —Å–æ—á–µ—Ç–∞–Ω–∏–µ "qu" –∏–º–µ–µ—Ç —Ç–µ–Ω–¥–µ–Ω—Ü–∏—é –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤–º–µ—Å—Ç–µ, –∏–º–µ–Ω–∞ —Ä–µ–¥–∫–æ —Å–æ–¥–µ—Ä–∂–∞—Ç —Ç—Ä–∏ —Å–æ–≥–ª–∞—Å–Ω—ã—Ö –ø–æ–¥—Ä—è–¥ –∏ —Ç.–¥. –ú–æ–¥–µ–ª—å –Ω–µ –∏–∑—É—á–∞–µ—Ç —è–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞, –æ–Ω–∞ –∏–∑—É—á–∞–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π, –∫–æ—Ç–æ—Ä–æ–µ, —Ç–∞–∫ —É–∂ –≤—ã—à–ª–æ, –∏—Ö –æ—Ç—Ä–∞–∂–∞–µ—Ç.

*–ö–∞–∫ —ç—Ç–æ —Å–≤—è–∑–∞–Ω–æ —Å ChatGPT?*

ChatGPT ‚Äî —ç—Ç–æ —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π –±–∞–∑–æ–≤—ã–π —Ü–∏–∫–ª (–ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ç–æ–∫–µ–Ω, —Å—ç–º–ø–ª–∏—Ä–æ–≤–∞—Ç—å, –ø–æ–≤—Ç–æ—Ä–∏—Ç—å), –Ω–æ –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –ø–æ—Å—Ç-–æ–±—É—á–µ–Ω–∏–µ–º –¥–ª—è –ø—Ä–∏–¥–∞–Ω–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤. –ö–æ–≥–¥–∞ –≤—ã –æ–±—â–∞–µ—Ç–µ—Å—å —Å –Ω–∏–º, —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç, –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –µ–≥–æ –æ—Ç–≤–µ—Ç ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —Ç–æ–∫–µ–Ω—ã –≤ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –ú–æ–¥–µ–ª—å –∑–∞–≤–µ—Ä—à–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø–æ –æ–¥–Ω–æ–º—É —Ç–æ–∫–µ–Ω—É –∑–∞ —Ä–∞–∑, —Ç–æ—á–Ω–æ —Ç–∞–∫ –∂–µ, –∫–∞–∫ `microgpt` –∑–∞–≤–µ—Ä—à–∞–µ—Ç –∏–º—è.

*–í —á–µ–º –ø—Ä–∏–∫–æ–ª —Å "–≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è–º–∏"?*

–ú–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω—ã, —Å—ç–º–ø–ª–∏—Ä—É—è –∏—Ö –∏–∑ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π. –£ –Ω–µ–µ –Ω–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è –∏—Å—Ç–∏–Ω—ã, –æ–Ω–∞ –∑–Ω–∞–µ—Ç —Ç–æ–ª—å–∫–æ, –∫–∞–∫–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–Ω—ã, —É—á–∏—Ç—ã–≤–∞—è –æ–±—É—á–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ. "–ì–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è" `microgpt`, –ø—Ä–∏–¥—É–º—ã–≤–∞—é—â–µ–≥–æ –∏–º—è –≤—Ä–æ–¥–µ "karia", ‚Äî —ç—Ç–æ —Ç–æ –∂–µ —Å–∞–º–æ–µ —è–≤–ª–µ–Ω–∏–µ, —á—Ç–æ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ–µ –∑–∞—è–≤–ª–µ–Ω–∏–µ ChatGPT –æ –ª–æ–∂–Ω–æ–º —Ñ–∞–∫—Ç–µ. –ò —Ç–æ, –∏ –¥—Ä—É–≥–æ–µ ‚Äî –ø—Ä–∞–≤–¥–æ–ø–æ–¥–æ–±–Ω–æ –∑–≤—É—á–∞—â–∏–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ, —Ç–∞–∫ —É–∂ –≤—ã—à–ª–æ, –Ω–µ —è–≤–ª—è—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–º–∏.

*–ü–æ—á–µ–º—É —ç—Ç–æ —Ç–∞–∫ –º–µ–¥–ª–µ–Ω–Ω–æ?*

`microgpt` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ –æ–¥–Ω–æ–º—É —Å–∫–∞–ª—è—Ä—É –∑–∞ —Ä–∞–∑ –Ω–∞ —á–∏—Å—Ç–æ–º Python. –û–¥–∏–Ω —à–∞–≥ –æ–±—É—á–µ–Ω–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç —Å–µ–∫—É–Ω–¥—ã. –¢–∞ –∂–µ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –Ω–∞ GPU –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –º–∏–ª–ª–∏–æ–Ω—ã —Å–∫–∞–ª—è—Ä–æ–≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—è–¥–∫–∏ –±—ã—Å—Ç—Ä–µ–µ.

*–ú–æ–≥—É –ª–∏ —è –∑–∞—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ª—É—á—à–∏–µ –∏–º–µ–Ω–∞?*

–î–∞. –û–±—É—á–∞–π—Ç–µ –¥–æ–ª—å—à–µ (—É–≤–µ–ª–∏—á—å—Ç–µ `num_steps`), —Å–¥–µ–ª–∞–π—Ç–µ –º–æ–¥–µ–ª—å –±–æ–ª—å—à–µ (`n_embd`, `n_layer`, `n_head`) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª—å—à–∏–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ —Ç–µ –∂–µ —Å–∞–º—ã–µ —Ä—ã—á–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–º–µ–Ω–∏–º—ã –∏ –≤ –±–æ–ª—å—à–∏—Ö –º–∞—Å—à—Ç–∞–±–∞—Ö.

*–ß—Ç–æ –µ—Å–ª–∏ —è –∏–∑–º–µ–Ω—é –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö?*

–ú–æ–¥–µ–ª—å –≤—ã—É—á–∏—Ç —Ç–µ –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å –≤ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–¥—Å—Ç–∞–≤—å—Ç–µ —Ñ–∞–π–ª —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –≥–æ—Ä–æ–¥–æ–≤, –∏–º–µ–Ω–∞–º–∏ –ø–æ–∫–µ–º–æ–Ω–æ–≤, –∞–Ω–≥–ª–∏–π—Å–∫–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ –∏–ª–∏ –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏—è–º–∏, –∏ –º–æ–¥–µ–ª—å –Ω–∞—É—á–∏—Ç—Å—è –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤–º–µ—Å—Ç–æ –∏–º–µ–Ω. –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

–¢–æ–ª—å–∫–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –æ–ø—Ä–æ—Å–µ. [–í–æ–π–¥–∏—Ç–µ](https://habr.com/kek/v1/auth/habrahabr/?back=&hl=ru), –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.

25% –î–∞, –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ –º–æ–∂–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å gpt ¬´–Ω–∞ –ø–∞–ª—å—Ü–∞—Ö¬ª!1

25% –î–ª—è –º–µ–Ω—è –∑–¥–µ—Å—å –Ω–µ—Ç –Ω–∏—á–µ–≥–æ –Ω–æ–≤–æ–≥–æ 1

50% –°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ö 2

–ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ 4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –í–æ–∑–¥–µ—Ä–∂–∞–ª—Å—è 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å.

+2